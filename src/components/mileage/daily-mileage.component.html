<div class="space-y-4 sm:space-y-6 min-w-0 overflow-hidden px-2 sm:px-0">
  <div>
    <div class="bg-brand-primary-500 dark:bg-brand-primary-700 rounded-lg px-6 py-4 mb-2">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="min-w-0">
          <h2 class="text-xl sm:text-2xl font-bold text-white wrap-break-word">
            <i class="fas fa-tachometer-alt mr-2"></i>
            {{ 'dailyMileage' | i18n }}
          </h2>
          <p class="text-white dark:text-neutral-100 text-sm mt-1">{{ 'dailyMileageSubtitle' | i18n }}</p>
        </div>
        <!-- Botão Cadastrar Quilometragem - Apenas para Admin -->
                @if (!isAdmin() && todayMileage()) {
                  <div class="flex gap-2 mt-2">
                    <button (click)="showFuelingForm.set(true)"
                        class="inline-flex items-center justify-center gap-2 px-4 py-2 bg-white text-green-600 text-sm font-medium rounded-lg hover:bg-green-50 focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-2 focus:ring-offset-green-100 transition-all transform hover:scale-105 shadow-lg sm:w-auto w-full">
                        <i class="fas fa-gas-pump"></i>
                        <span>{{ "addFueling" | i18n }}</span>
                    </button>
                    <button (click)="showEndForm.set(true)"
                        class="inline-flex items-center justify-center gap-2 px-4 py-2 bg-white text-blue-600 text-sm font-medium rounded-lg hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2 focus:ring-offset-blue-100 transition-all transform hover:scale-105 shadow-lg sm:w-auto w-full">
                        <i class="fas fa-flag-checkered"></i>
                        <span>{{ "endDay" | i18n }}</span>
                    </button>
                  </div>
                }
        @if (isAdmin()) {
          <button (click)="showAdminRegisterForm.set(true)"
              class="inline-flex items-center justify-center gap-2 px-4 py-2 bg-white text-brand-primary-500 text-sm font-medium rounded-lg hover:bg-brand-primary-50 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-brand-primary-500 transition-all transform hover:scale-105 shadow-lg sm:w-auto w-full">
              <i class="fas fa-plus"></i>
              <span>{{ "registerMileage" | i18n }}</span>
          </button>
        }
        @if (!isAdmin() && !todayMileage()) {
          <button (click)="showStartForm.set(true)"
              class="inline-flex items-center justify-center gap-2 px-4 py-2 bg-white text-brand-primary-500 text-sm font-medium rounded-lg hover:bg-brand-primary-50 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-brand-primary-500 transition-all transform hover:scale-105 shadow-lg sm:w-auto w-full">
              <i class="fas fa-plus"></i>
              <span>{{ "startDay" | i18n }}</span>
          </button>
        }
      </div>
    </div>
  </div>



  <!-- Start Day Form -->
  @if (showStartForm()) {
    <div class="bg-white dark:bg-neutral-800 rounded-lg shadow p-6 mb-6">
      <h3 class="text-lg font-semibold mb-4">{{ 'startDay' | i18n }}</h3>
      <form (ngSubmit)="startDay()" class="space-y-4">
        <div>
          <label for="startDate" class="block text-sm font-medium mb-1">{{ 'date' | i18n }}</label>
          <input
            id="startDate"
            type="date"
            [ngModel]="startDate()"
            (ngModelChange)="startDate.set($event)"
            name="startDate"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            required>
        </div>
        <div>
          <label for="startKilometers" class="block text-sm font-medium mb-1">{{ 'initial' | i18n }}</label>
          <input
            id="startKilometers"
            type="number"
            [ngModel]="startKilometers()"
            (input)="onStartKilometersChange($event)"
            name="startKilometers"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            placeholder="0"
            min="0"
            required>
        </div>
        <div class="flex gap-2">
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            {{ 'save' | i18n }}
          </button>
          <button type="button" (click)="showStartForm.set(false)" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
            {{ 'cancel' | i18n }}
          </button>
        </div>
      </form>
    </div>
  }

  <!-- End Day Form -->
  @if (showEndForm()) {
    <div class="bg-white dark:bg-neutral-800 rounded-lg shadow p-6 mb-6">
      <h3 class="text-lg font-semibold mb-4">{{ 'endDay' | i18n }}</h3>
      <form (ngSubmit)="endDay()" class="space-y-4">
        <div>
          <label for="endKilometers" class="block text-sm font-medium mb-1">{{ 'final' | i18n }}</label>
          <input
            id="endKilometers"
            type="number"
            [ngModel]="endKilometers()"
            (ngModelChange)="onEndKilometersChange($event)"
            name="endKilometers"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            [placeholder]="todayMileage()?.start_kilometers.toString()"
            [min]="todayMileage()?.start_kilometers"
            required>
        </div>
        <div class="flex gap-2">
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            {{ 'save' | i18n }}
          </button>
          <button type="button" (click)="showEndForm.set(false)" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
            {{ 'cancel' | i18n }}
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Admin Register Mileage Form -->
  @if (showAdminRegisterForm()) {
    <div class="bg-white dark:bg-neutral-800 rounded-lg shadow p-6 mb-6">
      <h3 class="text-lg font-semibold mb-4">{{ 'registerMileage' | i18n }}</h3>
      <form (ngSubmit)="registerMileageAsAdmin()" class="space-y-4">
        <div>
          <label for="adminRegisterDate" class="block text-sm font-medium mb-1">{{ 'date' | i18n }}</label>
          <input
            id="adminRegisterDate"
            type="date"
            [ngModel]="adminRegisterDate()"
            (ngModelChange)="adminRegisterDate.set($event)"
            name="adminRegisterDate"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            required>
        </div>
        <div>
          <label for="adminRegisterProfessional" class="block text-sm font-medium mb-1">{{ 'professional' | i18n }}</label>
          <select
            id="adminRegisterProfessional"
            [ngModel]="adminRegisterProfessionalId()"
            (change)="onAdminProfessionalChange($event)"
            name="adminRegisterProfessional"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            required>
            <option value="">{{ 'selectProfessional' | i18n }}</option>
            @for (professional of professionals(); track professional) {
              <option [value]="professional.id.toString()">
                {{ professional.name }}
              </option>
            }
          </select>
        </div>
        <div>
          <label for="adminRegisterLicensePlate" class="block text-sm font-medium mb-1">{{ 'licensePlate' | i18n }}</label>
          <input
            id="adminRegisterLicensePlate"
            type="text"
            [ngModel]="adminRegisterLicensePlate()"
            (ngModelChange)="adminRegisterLicensePlate.set($event)"
            name="adminRegisterLicensePlate"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            placeholder="AA-00-BB"
            required>
        </div>
        <div>
          <label for="adminRegisterStartKilometers" class="block text-sm font-medium mb-1">{{ 'initial' | i18n }}</label>
          <input
            id="adminRegisterStartKilometers"
            type="number"
            [ngModel]="adminRegisterStartKilometers()"
            (input)="onAdminRegisterStartKilometersChange($event)"
            name="adminRegisterStartKilometers"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            placeholder="0"
            min="0"
            required>
        </div>
        <div>
          <label for="adminRegisterEndKilometers" class="block text-sm font-medium mb-1">{{ 'final' | i18n }} <span class="text-sm text-gray-500">({{ 'optional' | i18n }})</span></label>
          <input
            id="adminRegisterEndKilometers"
            type="number"
            [ngModel]="adminRegisterEndKilometers()"
            (input)="onAdminRegisterEndKilometersChange($event)"
            name="adminRegisterEndKilometers"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            placeholder="0"
            min="0">
        </div>
        <div class="flex gap-2">
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            {{ 'save' | i18n }}
          </button>
          <button type="button" (click)="showAdminRegisterForm.set(false); adminRegisterProfessionalId.set(null); adminRegisterLicensePlate.set(''); adminRegisterStartKilometers.set(null); adminRegisterEndKilometers.set(null)" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
            {{ 'cancel' | i18n }}
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Fueling Form -->
  @if (showFuelingForm()) {
    <div class="bg-white dark:bg-neutral-800 rounded-lg shadow p-6 mb-6">
      <h3 class="text-lg font-semibold mb-4">{{ 'addFueling' | i18n }}</h3>
      <form (ngSubmit)="addFueling()" class="space-y-4">
        <div>
          <label for="fuelingValue" class="block text-sm font-medium mb-1">{{ 'fuelingValue' | i18n }}</label>
          <input
            id="fuelingValue"
            type="number"
            step="0.01"
            [ngModel]="fuelingValue()"
            (ngModelChange)="onFuelingValueChange($event)"
            name="fuelingValue"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            placeholder="0.00"
            min="0"
            required>
        </div>
        <div>
          <label for="fuelingLicensePlate" class="block text-sm font-medium mb-1">{{ 'licensePlate' | i18n }}</label>
          <input
            id="fuelingLicensePlate"
            type="text"
            [ngModel]="fuelingLicensePlate()"
            (ngModelChange)="fuelingLicensePlate.set($event)"
            name="fuelingLicensePlate"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
            placeholder="AA-00-BB"
            required>
        </div>
        <div>
          <label for="receiptImage" class="block text-sm font-medium mb-1">{{ 'receiptImage' | i18n }}</label>
          <input
            id="receiptImage"
            type="file"
            accept="image/*"
            (change)="onFileSelected($event)"
            class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600">
        </div>
        <div class="flex gap-2">
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            {{ 'save' | i18n }}
          </button>
          <button type="button" (click)="showFuelingForm.set(false); fuelingValue.set(null); fuelingLicensePlate.set(''); fuelingReceiptFile.set(null)" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
            {{ 'cancel' | i18n }}
          </button>
        </div>
      </form>
    </div>
  }

  <!-- History -->
  <div class="bg-white dark:bg-neutral-800 rounded-lg shadow p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold">{{ 'mileageHistory' | i18n }}</h2>
      <button
        (click)="toggleFilters()"
        class="px-4 py-2 text-sm font-medium rounded-lg border transition-all duration-200
               bg-white dark:bg-gray-800 border-blue-200 dark:border-blue-700
               text-brand-primary-600 dark:text-gray-200 hover:bg-brand-primary-50 dark:hover:bg-gray-700
               focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-brand-primary-500
               flex items-center gap-2 shadow-lg">
        <i class="fas" [ngClass]="showFilters() ? 'fa-eye-slash' : 'fa-eye'" aria-hidden="true"></i>
        <span class="hidden sm:inline">{{ showFilters() ? ('hideFilters' | i18n) : ('showFilters' | i18n) }}</span>
      </button>
    </div>

    <!-- Active Filters -->
    @if (activeFilters().length > 0) {
      <div class="mb-4 p-3 bg-white dark:bg-neutral-800 rounded border dark:border-neutral-600">
        <h4 class="text-sm font-medium mb-2">{{ 'activeFilters' | i18n }}</h4>
        <div class="flex flex-wrap gap-2">
          @for (filter of activeFilters(); track filter) {
            <span class="inline-flex items-center bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-1 rounded text-sm">
              {{ filter.labelKey | i18n }}: {{ filter.value }}
              <button (click)="clearFilter(filter.key)" class="ml-2 text-red-600 hover:text-red-800" aria-label="Remover filtro">
                ×
              </button>
            </span>
          }
        </div>
      </div>
    }

    <!-- Filters -->
    @if (showFilters()) {
      <div class="mb-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 border border-gray-200 dark:border-gray-700">
        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-brand-primary-600 dark:text-brand-primary-300">
          <i class="fas fa-filter"></i>
          {{ 'filters' | i18n }}
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          <div class="flex flex-col gap-1">
            <label for="filterStartDate" class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
              <i class="fas fa-calendar text-brand-primary-500"></i>
              {{ 'startDate' | i18n }}
            </label>
            <input
              id="filterStartDate"
              type="date"
              [ngModel]="filterStartDate()"
              (ngModelChange)="filterStartDate.set($event)"
              name="filterStartDate"
              class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all">
          </div>
          <div class="flex flex-col gap-1">
            <label for="filterEndDate" class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
              <i class="fas fa-calendar text-brand-primary-500"></i>
              {{ 'endDate' | i18n }}
            </label>
            <input
              id="filterEndDate"
              type="date"
              [ngModel]="filterEndDate()"
              (ngModelChange)="filterEndDate.set($event)"
              name="filterEndDate"
              class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all">
          </div>
          <div class="flex flex-col gap-1">
            <label for="filterMinDriven" class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
              <i class="fas fa-road text-brand-primary-500"></i>
              {{ 'minDriven' | i18n }}
            </label>
            <input
              id="filterMinDriven"
              type="number"
              [ngModel]="filterMinDriven()"
              (ngModelChange)="onFilterMinDrivenChange($event)"
              name="filterMinDriven"
              class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
              [placeholder]="'placeholderMinDriven' | i18n"
              min="0">
          </div>
          <div class="flex flex-col gap-1">
            <label for="filterMaxDriven" class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
              <i class="fas fa-road text-brand-primary-500"></i>
              {{ 'maxDriven' | i18n }}
            </label>
            <input
              id="filterMaxDriven"
              type="number"
              [ngModel]="filterMaxDriven()"
              (ngModelChange)="onFilterMaxDrivenChange($event)"
              name="filterMaxDriven"
              class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
              [placeholder]="'placeholderMaxDriven' | i18n"
              min="0">
          </div>
          <div class="flex flex-col gap-1">
            <label for="filterMinFueling" class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
              <i class="fas fa-gas-pump text-brand-primary-500"></i>
              {{ 'minFueling' | i18n }}
            </label>
            <input
              id="filterMinFueling"
              type="number"
              step="0.01"
              [ngModel]="filterMinFueling()"
              (ngModelChange)="onFilterMinFuelingChange($event)"
              name="filterMinFueling"
              class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
              [placeholder]="'placeholderMinFueling' | i18n"
              min="0">
          </div>
          <div class="flex flex-col gap-1">
            <label for="filterMaxFueling" class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
              <i class="fas fa-gas-pump text-brand-primary-500"></i>
              {{ 'maxFueling' | i18n }}
            </label>
            <input
              id="filterMaxFueling"
              type="number"
              step="0.01"
              [ngModel]="filterMaxFueling()"
              (ngModelChange)="onFilterMaxFuelingChange($event)"
              name="filterMaxFueling"
              class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
              [placeholder]="'placeholderMaxFueling' | i18n"
              min="0">
          </div>
          <div class="flex flex-col gap-1">
            <label for="filterLicensePlate" class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
              <i class="fas fa-car text-brand-primary-500"></i>
              {{ 'licensePlate' | i18n }}
            </label>
            <input
              id="filterLicensePlate"
              type="text"
              [ngModel]="filterLicensePlate()"
              (ngModelChange)="onFilterLicensePlateChange($event)"
              name="filterLicensePlate"
              class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
              [placeholder]="'placeholderLicensePlate' | i18n">
          </div>
          @if (isAdmin()) {
            <div class="flex flex-col gap-1">
              <label for="filterProfessional" class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                <i class="fas fa-user-tie text-brand-primary-500"></i>
                {{ 'professional' | i18n }}
              </label>
              <select
                id="filterProfessional"
                [ngModel]="filterProfessionalId()"
                (ngModelChange)="onFilterProfessionalChange($event)"
                name="filterProfessional"
                class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all">
                <option value="">{{ 'all' | i18n }}</option>
                @for (professional of professionals(); track professional) {
                  <option [value]="professional.id">
                    {{ professional.name }}
                  </option>
                }
              </select>
            </div>
          }
        </div>
        <div class="flex flex-wrap gap-2 mt-4 justify-end">
          <button
            type="button"
            (click)="clearFilters()"
            class="px-4 py-2 rounded-lg bg-gray-600 text-white font-medium hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-all">
            <i class="fas fa-eraser mr-2"></i>{{ 'clearFilters' | i18n }}
          </button>
        </div>
      </div>
    }

    <div class="space-y-4">
      <!-- Mobile cards -->
      <div class="md:hidden space-y-3">
        @for (mileage of paginatedMileages(); track mileage) {
          <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-md p-4 mb-4 border border-gray-200 dark:border-neutral-700">
            <div class="flex flex-col gap-2 mb-2">
              <div>
                <div class="text-xs text-gray-500 dark:text-neutral-400 font-medium">{{ mileage.date | date:'dd/MM/yyyy' }}</div>
                <div class="font-semibold text-base text-gray-800 dark:text-neutral-100">{{ getProfessionalName(mileage.professional_id) }}</div>
              </div>
              <div class="flex flex-wrap gap-2 text-sm mt-1">
                <div class="flex items-center gap-1">
                  <i class="fas fa-car text-gray-400"></i>
                  <span class="text-gray-600 dark:text-neutral-400">{{ 'licensePlate' | i18n }}:</span>
                  <span class="font-medium">{{ getLicensePlateForMileage(mileage) }}</span>
                </div>
                <div class="flex items-center gap-1">
                  <i class="fas fa-gas-pump text-gray-400"></i>
                  <span class="text-gray-600 dark:text-neutral-400">{{ 'fuelingTotal' | i18n }}:</span>
                  <span class="font-medium">{{ getTotalFueling(mileage) | number:'1.2-2':'pt-PT' }} €</span>
                </div>
              </div>
              <div class="flex flex-wrap gap-2 text-sm">
                <div class="flex items-center gap-1">
                  <i class="fas fa-sign-in-alt text-gray-400"></i>
                  <span class="text-gray-600 dark:text-neutral-400">{{ 'initial' | i18n }}:</span>
                  <span class="font-medium">{{ mileage.start_kilometers | number:'1.0-0':'pt-PT' }} km</span>
                </div>
                <div class="flex items-center gap-1">
                  <i class="fas fa-sign-out-alt text-gray-400"></i>
                  <span class="text-gray-600 dark:text-neutral-400">{{ 'final' | i18n }}:</span>
                  <span class="font-medium">{{ mileage.end_kilometers ? (mileage.end_kilometers | number:'1.0-0':'pt-PT') + ' km' : '-' }}</span>
                </div>
              </div>
              <div class="flex items-center gap-1 text-sm mt-1">
                <i class="fas fa-road text-gray-400"></i>
                <span class="text-gray-600 dark:text-neutral-400">{{ 'kilometersDriven' | i18n }}:</span>
                <span class="font-semibold">{{ getKilometersDriven(mileage) | number:'1.0-0':'pt-PT' }} km</span>
              </div>
            </div>
            <div class="flex items-center justify-center gap-4 mt-3">
              <button
                type="button"
                (click)="openEditDailyMileage(mileage)"
                class="w-10 h-10 flex items-center justify-center text-blue-600 hover:text-blue-800 dark:text-blue-400 bg-gray-100 dark:bg-neutral-700 rounded-md transition-colors"
                [attr.aria-label]="'editDailyMileage' | i18n">
                <i class="fas fa-pen" aria-hidden="true"></i>
              </button>
              <button
                type="button"
                (click)="viewFuelings(mileage)"
                class="w-10 h-10 flex items-center justify-center text-blue-600 hover:text-blue-800 dark:text-blue-400 bg-gray-100 dark:bg-neutral-700 rounded-md transition-colors"
                [attr.aria-label]="'viewFuelings' | i18n">
                <i class="fas fa-eye" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        }
      </div>

      <!-- Mileage Table (md+) -->
      <div class="hidden md:block overflow-x-auto">
        <table class="min-w-full table-auto border-collapse">
          <thead class="hidden md:table-header-group">
            <tr class="bg-gray-100 dark:bg-neutral-600">
              <th class="px-4 py-2 text-center">
                <button (click)="sortByColumn('date')" class="hover:text-blue-600 font-semibold">
                  {{ 'date' | i18n }} {{ sortBy() === 'date' ? (sortOrder() === 'asc' ? '↑' : '↓') : '' }}
                </button>
              </th>
              @if (isAdmin()) {
                <th class="px-4 py-2 text-left">{{ 'professional' | i18n }}</th>
              }
              <th class="px-4 py-2 text-left">{{ 'licensePlate' | i18n }}</th>
              <th class="px-4 py-2 text-right">{{ 'initial' | i18n }}</th>
              <th class="px-4 py-2 text-right">{{ 'final' | i18n }}</th>
              <th class="px-4 py-2 text-right">
                <button (click)="sortByColumn('driven')" class="hover:text-blue-600 font-semibold">
                  {{ 'kilometersDriven' | i18n }} {{ sortBy() === 'driven' ? (sortOrder() === 'asc' ? '↑' : '↓') : '' }}
                </button>
              </th>
              <th class="px-4 py-2 text-right">
                <button (click)="sortByColumn('fueling')" class="hover:text-blue-600 font-semibold">
                  {{ 'fuelings' | i18n }} {{ sortBy() === 'fueling' ? (sortOrder() === 'asc' ? '↑' : '↓') : '' }}
                </button>
              </th>
              <th class="px-4 py-2 text-left">{{ 'actions' | i18n }}</th>
            </tr>
          </thead>
          <tbody>
            @for (mileage of paginatedMileages(); track mileage) {
              <tr class="border-b dark:border-neutral-600 md:table-row block md:table-row">
                <td class="px-4 py-2 md:table-cell block">
                  <div class="md:hidden flex justify-between items-center">
                    <span class="font-semibold text-left">{{ 'date' | i18n }}:</span>
                    <span class="text-right">{{ mileage.date | date:'dd/MM/yyyy' }}</span>
                  </div>
                  <span class="hidden md:block text-center">{{ mileage.date | date:'dd/MM/yyyy' }}</span>
                </td>
                @if (isAdmin()) {
                  <td class="px-4 py-2 md:table-cell block">
                    <div class="md:hidden flex justify-between items-center">
                      <span class="font-semibold text-left">{{ 'professional' | i18n }}:</span>
                      <span class="text-right">{{ getProfessionalName(mileage.professional_id) }}</span>
                    </div>
                    <span class="hidden md:block text-left">{{ getProfessionalName(mileage.professional_id) }}</span>
                  </td>
                }
                <td class="px-4 py-2 md:table-cell block">
                  <div class="md:hidden flex justify-between items-center">
                    <span class="font-semibold text-left">{{ 'licensePlate' | i18n }}:</span>
                    <span class="text-right">{{ getLicensePlateForMileage(mileage) }}</span>
                  </div>
                  <span class="hidden md:block text-left">{{ getLicensePlateForMileage(mileage) }}</span>
                </td>
                <td class="px-4 py-2 md:table-cell block">
                  <div class="md:hidden flex justify-between items-center">
                    <span class="font-semibold text-left">{{ 'initial' | i18n }}:</span>
                    <span class="text-right">{{ mileage.start_kilometers | number:'1.0-0':'pt-PT' }} km</span>
                  </div>
                  <span class="hidden md:block text-right">{{ mileage.start_kilometers | number:'1.0-0':'pt-PT' }} km</span>
                </td>
                <td class="px-4 py-2 md:table-cell block">
                  <div class="md:hidden flex justify-between items-center">
                    <span class="font-semibold text-left">{{ 'final' | i18n }}:</span>
                    <span class="text-right">{{ (mileage.end_kilometers ? (mileage.end_kilometers | number:'1.0-0':'pt-PT') : '-') + (mileage.end_kilometers ? ' km' : '') }}</span>
                  </div>
                  <span class="hidden md:block text-right">{{ (mileage.end_kilometers ? (mileage.end_kilometers | number:'1.0-0':'pt-PT') : '-') + (mileage.end_kilometers ? ' km' : '') }}</span>
                </td>
                <td class="px-4 py-2 md:table-cell block">
                  <div class="md:hidden flex justify-between items-center">
                    <span class="font-semibold text-left">{{ 'kilometersDriven' | i18n }}:</span>
                    <span class="text-right">{{ getKilometersDriven(mileage) | number:'1.0-0':'pt-PT' }} km</span>
                  </div>
                  <span class="hidden md:block text-right">{{ getKilometersDriven(mileage) | number:'1.0-0':'pt-PT' }} km</span>
                </td>
                <td class="px-4 py-2 md:table-cell block">
                  <div class="md:hidden flex justify-between items-center">
                    <span class="font-semibold text-left">{{ 'fuelings' | i18n }}:</span>
                    <span class="text-right">{{ getTotalFueling(mileage) | number:'1.2-2':'pt-PT' }} €</span>
                  </div>
                  <span class="hidden md:block text-right">{{ getTotalFueling(mileage) | number:'1.2-2':'pt-PT' }} €</span>
                </td>
                <td class="px-4 py-2 md:table-cell block text-left">
                  <div class="flex items-center gap-3">
                    <button
                      type="button"
                      (click)="openEditDailyMileage(mileage)"
                      class="text-blue-600 hover:text-blue-800 dark:text-blue-400"
                      [attr.aria-label]="'editDailyMileage' | i18n"
                      [title]="'editDailyMileage' | i18n">
                      <i class="fas fa-pen" aria-hidden="true"></i>
                    </button>
                    <button
                      type="button"
                      (click)="viewFuelings(mileage)"
                      class="text-blue-600 hover:text-blue-800 dark:text-blue-400"
                      [attr.aria-label]="'viewFuelings' | i18n"
                      [title]="'viewFuelings' | i18n">
                      <i class="fas fa-eye" aria-hidden="true"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <!-- Mobile Actions Row -->
              <tr class="md:hidden border-b dark:border-neutral-600">
                <td colspan="100%" class="px-4 py-2">
                  <div class="flex items-center justify-center gap-4">
                    <button
                      type="button"
                      (click)="openEditDailyMileage(mileage)"
                      class="text-blue-600 hover:text-blue-800 dark:text-blue-400 flex items-center gap-2"
                      [attr.aria-label]="'editDailyMileage' | i18n">
                      <i class="fas fa-pen" aria-hidden="true"></i>
                    </button>
                    <button
                      type="button"
                      (click)="viewFuelings(mileage)"
                      class="text-blue-600 hover:text-blue-800 dark:text-blue-400 flex items-center gap-2"
                      [attr.aria-label]="'viewFuelings' | i18n">
                      <i class="fas fa-eye" aria-hidden="true"></i>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination Controls -->
    @if(dailyMileages().length > 0) {
    <div
        class="bg-white dark:bg-gray-800 px-4 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between border-t border-gray-200 dark:border-gray-700 space-y-3 sm:space-y-0">
        <!-- Items per page selector -->
        <div class="flex items-center space-x-2">
            <span class="text-sm text-gray-700">{{ "itemsPerPage" | i18n }}:</span>
            <select [value]="itemsPerPage()" (change)="setItemsPerPage(+$event.target.value)"
                class="border border-gray-300 rounded-md px-2 py-1 text-sm">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
            </select>
        </div>

        <!-- Pagination info (hidden on mobile) -->
        <div class="hidden sm:block">
            <p class="text-sm text-gray-700">
                {{ "showing" | i18n }}
                <span class="font-medium">{{
                    (currentPage() - 1) * itemsPerPage() + 1
                    }}</span>
                {{ "to" | i18n }}
                <span class="font-medium">{{
                    Math.min(currentPage() * itemsPerPage(), dailyMileages().length)
                    }}</span>
                {{ "of" | i18n }}
                <span class="font-medium">{{ dailyMileages().length }}</span>
                {{ "results" | i18n }}
            </p>
        </div>

        <!-- Pagination buttons -->
        <div class="flex justify-center sm:justify-end">
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <!-- Previous button -->
                <button (click)="previousPage()" [disabled]="currentPage() === 1"
                    class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-left"></i>
                    <span class="sr-only">Previous</span>
                </button>

                <!-- Page numbers (simplified for mobile) -->
                <div class="hidden sm:flex">
                    @for(page of pageNumbers; track page) { @if(page === -1) {
                    <!-- Ellipsis -->
                    <span
                        class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-gray-300">
                        ...
                    </span>
                    } @else {
                    <button (click)="goToPage(page)" [class]="
              page === currentPage()
                ? 'relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-brand-primary-50 dark:bg-brand-primary-900 text-sm font-medium text-brand-primary-500 dark:text-brand-primary-400'
                : 'relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600'
            ">
                        {{ page }}
                    </button>
                    } }
                </div>

                <!-- Mobile page indicator -->
                <div
                    class="sm:hidden relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-gray-300">
                    {{ currentPage() }} / {{ totalPages() }}
                </div>

                <!-- Next button -->
                <button (click)="nextPage()" [disabled]="currentPage() === totalPages()"
                    class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-right"></i>
                    <span class="sr-only">Next</span>
                </button>
            </nav>
        </div>
    </div>
    }
  </div>

  <!-- Fuelings Modal -->
  @if (selectedDailyMileage()) {
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white dark:bg-neutral-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 mb-4">
          <h3 class="text-lg font-semibold min-w-0 wrap-break-word">
            {{ 'fuelingsFor' | i18n }} {{ selectedDailyMileage()!.date | date:'dd/MM/yyyy' }}
          </h3>
          <div class="flex items-center gap-2 self-end sm:self-auto shrink-0">
            @if (isAdmin()) {
              <button
                (click)="showModalFuelingForm.set(true)"
                class="inline-flex items-center justify-center w-9 h-9 rounded bg-green-600 text-white hover:bg-green-700"
                [attr.aria-label]="'addFueling' | i18n"
                [title]="'addFueling' | i18n">
                <i class="fas fa-plus" aria-hidden="true"></i>
              </button>
            }
            <button
              type="button"
              (click)="selectedDailyMileage.set(null)"
              class="inline-flex items-center justify-center w-9 h-9 rounded bg-gray-200 text-gray-800 hover:bg-gray-300 dark:bg-neutral-700 dark:text-neutral-100 dark:hover:bg-neutral-600"
              [attr.aria-label]="'close' | i18n"
              [title]="'close' | i18n">
              <i class="fas fa-times" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <div class="space-y-2">
          @for (fueling of filteredFuelingsForSelectedMileage(); track fueling) {
            <div class="flex justify-between items-center p-2 border rounded dark:border-neutral-600">
              <div>
                <span class="font-medium">{{ fueling.value | number:'1.2-2':'pt-PT' }} €</span>
                <span class="text-sm text-gray-600 dark:text-neutral-400 ml-2">{{ fueling.created_at | date:'short' }}</span>
              </div>
              @if (fueling.receipt_image_url) {
                <div>
                  <a [href]="fueling.receipt_image_url" target="_blank" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-image"></i> {{ 'viewReceipt' | i18n }}
                  </a>
                </div>
              }
            </div>
          }
          @if (filteredFuelingsForSelectedMileage().length === 0) {
            <div class="text-center text-gray-600 dark:text-neutral-400 py-4">
              {{ 'noFuelings' | i18n }}
            </div>
          }
        </div>
        <!-- Add Fueling Form (for modal) -->
        @if (showModalFuelingForm()) {
          <div class="mt-4 p-4 bg-gray-50 dark:bg-neutral-700 rounded">
            <h4 class="text-md font-medium mb-3">{{ 'addFueling' | i18n }}</h4>
            <form (ngSubmit)="addFuelingToMileage(selectedDailyMileage()!.id)" class="space-y-3">
              <div>
                <label for="modalFuelingValue" class="block text-sm font-medium mb-1">{{ 'fuelingValue' | i18n }}</label>
                <input
                  id="modalFuelingValue"
                  type="number"
                  step="0.01"
                  [ngModel]="fuelingValue()"
                  (ngModelChange)="onFuelingValueChange($event)"
                  name="modalFuelingValue"
                  class="w-full p-2 border rounded dark:bg-neutral-600 dark:border-neutral-500"
                  placeholder="0.00"
                  min="0"
                  required>
              </div>
              <div>
                <label for="modalFuelingLicensePlate" class="block text-sm font-medium mb-1">{{ 'licensePlate' | i18n }}</label>
                <input
                  id="modalFuelingLicensePlate"
                  type="text"
                  [ngModel]="fuelingLicensePlate()"
                  (ngModelChange)="fuelingLicensePlate.set($event)"
                  name="modalFuelingLicensePlate"
                  class="w-full p-2 border rounded dark:bg-neutral-600 dark:border-neutral-500"
                  placeholder="AA-00-BB"
                  required>
              </div>
              <div>
                <label for="modalReceiptImage" class="block text-sm font-medium mb-1">{{ 'receiptImage' | i18n }}</label>
                <input
                  id="modalReceiptImage"
                  type="file"
                  accept="image/*"
                  (change)="onFileSelected($event)"
                  class="w-full p-2 border rounded dark:bg-neutral-600 dark:border-neutral-500">
              </div>
              <div class="flex gap-2">
                <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 text-sm">
                  {{ 'save' | i18n }}
                </button>
                <button type="button" (click)="showModalFuelingForm.set(false); fuelingValue.set(null); fuelingLicensePlate.set(''); fuelingReceiptFile.set(null)" class="bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700 text-sm">
                  {{ 'cancel' | i18n }}
                </button>
              </div>
            </form>
          </div>
        }
      </div>
    </div>
  }

  <!-- Edit Daily Mileage Modal -->
  @if (editingDailyMileage()) {
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white dark:bg-neutral-800 rounded-lg p-6 max-w-xl w-full mx-4">
        <div class="flex justify-between items-start gap-3 mb-4">
          <h3 class="text-lg font-semibold min-w-0 wrap-break-word">{{ 'editDailyMileage' | i18n }}</h3>
          <button
            type="button"
            (click)="closeEditDailyMileage()"
            class="inline-flex items-center justify-center w-9 h-9 rounded bg-gray-200 text-gray-800 hover:bg-gray-300 dark:bg-neutral-700 dark:text-neutral-100 dark:hover:bg-neutral-600 shrink-0"
            [attr.aria-label]="'close' | i18n"
            [title]="'close' | i18n">
            <i class="fas fa-times" aria-hidden="true"></i>
          </button>
        </div>

        <div class="text-sm text-gray-600 dark:text-neutral-400 mb-3">
          {{ 'date' | i18n }}: <span class="font-medium">{{ editingDailyMileage()!.date | date:'dd/MM/yyyy' }}</span>
        </div>

        <form (ngSubmit)="saveEditedDailyMileage()" class="space-y-4">
          <div>
            <label for="editLicensePlate" class="block text-sm font-medium mb-1">{{ 'licensePlate' | i18n }}</label>
            <input
              id="editLicensePlate"
              type="text"
              [ngModel]="editLicensePlate()"
              (ngModelChange)="editLicensePlate.set($event)"
              name="editLicensePlate"
              class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
              placeholder="AA-00-BB">
          </div>

          <div>
            <label for="editStartKilometers" class="block text-sm font-medium mb-1">{{ 'startKilometers' | i18n }}</label>
            <input
              id="editStartKilometers"
              type="number"
              [ngModel]="editStartKilometers()"
              (ngModelChange)="onEditStartKilometersChange($event)"
              name="editStartKilometers"
              class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
              min="0"
              required>
          </div>

          <div>
            <label for="editEndKilometers" class="block text-sm font-medium mb-1">{{ 'endKilometers' | i18n }} <span class="text-sm text-gray-500">({{ 'optional' | i18n }})</span></label>
            <input
              id="editEndKilometers"
              type="number"
              [ngModel]="editEndKilometers()"
              (ngModelChange)="onEditEndKilometersChange($event)"
              name="editEndKilometers"
              class="w-full p-2 border rounded dark:bg-neutral-700 dark:border-neutral-600"
              min="0">
          </div>

          <div class="flex gap-2">
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
              {{ 'save' | i18n }}
            </button>
            <button type="button" (click)="closeEditDailyMileage()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
              {{ 'cancel' | i18n }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>