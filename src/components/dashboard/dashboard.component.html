<!-- Modal de erro de negÃ³cio -->

@if (showBusinessError()) {
<div
  class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30"
>
  <div
    class="bg-white rounded-lg shadow-lg p-6 max-w-sm w-full text-center border border-red-300"
  >
    <div class="text-red-600 text-lg font-semibold mb-2">
      {{ businessErrorMessage() }}
    </div>
    <button
      class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
      (click)="showBusinessError.set(false)"
    >
      OK
    </button>
  </div>
</div>
}

<div class="space-y-4 sm:space-y-6 min-w-0 overflow-hidden px-2 sm:px-0">
  <div>
    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 break-words">
      {{ "welcomeBack" | i18n : { name: user().name } }}
    </h2>
    <p class="text-gray-500 text-sm sm:text-base">
      {{ "dashboardSummary" | i18n }}
    </p>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
    @for (stat of stats(); track stat.label) {
    <div
      class="bg-white p-4 sm:p-6 rounded-lg shadow flex items-center space-x-3 sm:space-x-4 min-w-0"
    >
      <div
        class="flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center rounded-full"
        [class.bg-yellow-100]="stat.icon.includes('yellow')"
        [class.bg-blue-100]="stat.icon.includes('blue')"
        [class.bg-green-100]="stat.icon.includes('green')"
        [class.bg-emerald-100]="stat.icon.includes('emerald')"
      >
        <i class="text-lg sm:text-2xl" [class]="stat.icon"></i>
      </div>
      <div class="flex-1 min-w-0">
        <span class="font-semibold text-gray-700">{{ stat.label }}</span>
        <span class="ml-2 text-gray-900">{{ stat.value }}</span>
      </div>
    </div>
    }
  </div>

  <!-- Service Lists OU Detalhes -->
  @if (selectedRequest()) {
  <app-service-request-details
    [request]="selectedRequest()"
    [currentUser]="user()"
    (close)="selectedRequest.set(null)"
    (refreshRequest)="selectedRequest.set(null)"
  ></app-service-request-details>
  } @else {
  <h3
    class="text-base sm:text-lg lg:text-xl font-semibold text-gray-800 mb-3 sm:mb-4 px-1 sm:px-0"
  >
    {{ "activeRequests" | i18n }}
  </h3>
  @if (user() && isArray(activeRequests()) && activeRequests().length > 0) {
  <app-service-list
    [serviceRequests]="activeRequests()"
    [currentUser]="user()"
    [enablePagination]="true"
    [itemsPerPageDefault]="10"
    (viewDetails)="handleViewDetails($event)"
    (openChat)="openChat.emit($event)"
    (payNow)="payNow.emit($event)"
    (approveQuote)="handleQuoteResponse($event, true)"
    (rejectQuote)="handleQuoteResponse($event, false)"
    (approveExecutionDate)="handleExecutionDateResponse($event, true)"
    (rejectExecutionDate)="
      handleExecutionDateResponse($event.request, false, $event.reason)
    "
    (scheduleRequest)="scheduleRequest.emit($event)"
    (provideClarification)="handleProvideClarification($event)"
    (finishService)="handleFinishService($event)"
  >
  </app-service-list>
  } @else {
  <div class="text-center text-gray-500 p-4">
    Nenhum agendamento encontrado.
  </div>
  }
  <h3
    class="text-base sm:text-lg lg:text-xl font-semibold text-gray-800 mb-3 sm:mb-4 px-1 sm:px-0"
  >
    {{ "completedRequests" | i18n }}
  </h3>
  <app-service-list
    [serviceRequests]="completedRequests()"
    [currentUser]="user()"
    [enablePagination]="true"
    [itemsPerPageDefault]="10"
    (viewDetails)="viewDetails.emit($event)"
    (openChat)="openChat.emit($event)"
    (payNow)="payNow.emit($event)"
  >
  </app-service-list>
  }
</div>
