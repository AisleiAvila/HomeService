<div class="flex flex-col h-full bg-white rounded-lg shadow-md overflow-hidden">
  <!-- Header -->
  <div class="p-4 border-b flex items-center space-x-4 bg-gray-50">
    @if (otherUser(); as other) {
      <div class="relative">
        <img [src]="other.avatarUrl" [alt]="other.name" class="h-12 w-12 rounded-full">
        <span class="absolute bottom-0 right-0 block h-3 w-3 rounded-full bg-green-400 ring-2 ring-white"></span>
      </div>
      <div>
        <h2 class="text-lg font-bold text-gray-800">{{ other.name }}</h2>
        <p class="text-sm text-gray-500">Discussing: {{ serviceRequest().title }}</p>
      </div>
    } @else {
       <div class="h-12 w-12 rounded-full bg-gray-300 flex items-center justify-center">
         <i class="fas fa-user-slash text-gray-500"></i>
       </div>
       <div>
        <h2 class="text-lg font-bold text-gray-800">No Professional Assigned</h2>
        <p class="text-sm text-gray-500">Discussing: {{ serviceRequest().title }}</p>
      </div>
    }
  </div>

  <!-- Messages Area -->
  <div #messagesContainer class="flex-1 p-6 overflow-y-auto space-y-4 bg-gray-100">
    @for (message of messages(); track message.id) {
      <div class="flex" [class.justify-end]="message.senderId === currentUser().id">
        <div 
          class="max-w-xs lg:max-w-lg p-3 rounded-xl shadow"
          [class.bg-blue-600]="message.senderId === currentUser().id"
          [class.text-white]="message.senderId === currentUser().id"
          [class.bg-white]="message.senderId !== currentUser().id"
          [class.text-gray-800]="message.senderId !== currentUser().id"
        >
          <p class="text-sm">{{ message.text }}</p>
          <p 
            class="text-xs mt-1 opacity-75"
            [class.text-right]="message.senderId === currentUser().id"
          >
            {{ message.timestamp | date:'shortTime' }}
          </p>
        </div>
      </div>
    }
  </div>

  <!-- Input Area -->
  <div class="p-4 border-t bg-white">
    <form (submit)="sendMessage()" class="flex items-center space-x-3">
      <input 
        type="text"
        [(ngModel)]="newMessage"
        name="newMessage"
        placeholder="Type your message..."
        class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
        autocomplete="off"
      >
      <button 
        type="submit"
        class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-300"
        [disabled]="!newMessage().trim()"
      >
        <i class="fas fa-paper-plane"></i>
      </button>
    </form>
  </div>
</div>