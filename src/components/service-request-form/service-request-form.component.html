<form
  autocomplete="off"
  (ngSubmit)="onSubmit()"
  class="w-full mobile-safe relative"
>
  <!-- Overlay spinner central -->
  <div
    *ngIf="isSubmitting()"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black dark:bg-gray-900 bg-opacity-30 dark:bg-opacity-50"
  >
    <div class="flex flex-col items-center">
      <svg
        class="animate-spin h-12 w-12 text-brand-primary-600 dark:text-brand-primary-400 mb-4"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
        ></path>
      </svg>
      <span class="text-white dark:text-gray-100 text-lg font-semibold drop-shadow">{{
        "loading" | i18n
      }}</span>
    </div>
  </div>

  <!-- Card Container -->
  <div class="bg-gradient-to-r from-brand-primary-600 to-brand-primary-500 rounded-lg shadow-md overflow-hidden">
    <!-- TÃ­tulo do FormulÃ¡rio -->
    <div class="px-6 py-4 border-b border-white border-opacity-20">
      <h2 class="text-2xl font-bold text-white flex items-center">
        <i class="fas fa-plus-circle mr-3"></i>
        {{ "newServiceRequest" | i18n }}
      </h2>
      <p class="text-white text-sm mt-1">
        {{ "fillFormToCreateRequest" | i18n }}
      </p>
    </div>

    <!-- Ordem correta dos campos -->
    <div class="p-6 bg-white dark:bg-gray-800">
      <!-- Origem da SolicitaÃ§Ã£o -->
      <div class="flex items-center gap-2 mb-4">
        <i class="fas fa-building text-brand-primary-600"></i>
        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">{{ 'requestOrigin' | i18n }}</h3>
      </div>
      <div class="mb-4">
        <label for="origin_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300">{{ 'origin' | i18n }}</label>
        <select id="origin_id" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" [value]="origin_id()" (change)="origin_id.set(+$event.target.value)" required>
          <option value="0" disabled selected>{{ 'selectOrigin' | i18n }}</option>
          <ng-container *ngFor="let origin of origins()">
            <option [value]="origin.id">{{ origin.name }}</option>
          </ng-container>
        </select>
      </div>

      <!-- Categoria do ServiÃ§o (Categoria/Subcategoria) -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <!-- Categoria -->
        <div>
          <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="category_id">
            <i class="fas fa-folder text-brand-primary-500 mr-2 text-xs"></i>
            {{ "category" | i18n }}
          </label>
          <select
            id="category_id"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [value]="category_id() || ''"
            (change)="onCategoryChange($any($event.target).value)"
            required
          >
            <option value="" disabled selected>{{ "selectCategory" | i18n }}</option>
            <ng-container *ngFor="let cat of categories()">
              <option [value]="cat.id">{{ cat.name }}</option>
            </ng-container>
          </select>
          <span
            *ngIf="!validFields().category_id && category_id()"
            class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          >
            <i class="fas fa-exclamation-circle mr-1"></i>
            {{ "selectCategory" | i18n }}
          </span>
        </div>

        <!-- Subcategoria -->
        <div>
          <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="subcategory_id">
            <i class="fas fa-tag text-brand-primary-500 mr-2 text-xs"></i>
            {{ "subcategory" | i18n }}
          </label>
          <select
            id="subcategory_id"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all disabled:bg-gray-100 dark:disabled:bg-gray-600 disabled:cursor-not-allowed bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [value]="subcategory_id() || ''"
            (change)="updateField('subcategory_id', $any($event.target).value)"
            [disabled]="!category_id()"
            required
          >
            <option value="" disabled selected>{{ "selectSubcategory" | i18n }}</option>
            <ng-container *ngFor="let sub of subcategories()">
              <option [value]="sub.id">{{ sub.name }}</option>
            </ng-container>
          </select>
          <span
            *ngIf="!validFields().subcategory_id && subcategory_id()"
            class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          >
            <i class="fas fa-exclamation-circle mr-1"></i>
            {{ "selectSubcategory" | i18n }}
          </span>
        </div>
      </div>

      <!-- Valor Total / Valor do Prestador -->
      <div class="flex gap-4 mb-4">
        <div class="w-1/2">
          <label for="valor" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Valor Total (â‚¬)</label>
          <input
            id="valor"
            type="number"
            min="0.01"
            step="0.01"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [value]="valor() ?? ''"
            (input)="updateField('valor', $event.target.value)"
            required
          />
        </div>
        <div class="w-1/2">
          <label for="valor_prestador" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Valor do Prestador (â‚¬)</label>
          <input
            id="valor_prestador"
            type="number"
            min="0.01"
            step="0.01"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [value]="valor_prestador() ?? ''"
            (input)="updateField('valor_prestador', $event.target.value)"
            required
          />
        </div>
      </div>
  </div>

  <!-- SeÃ§Ã£o de InformaÃ§Ãµes do Solicitante -->
  <div class="p-6 bg-white dark:bg-gray-800">
    <div class="flex items-center gap-2 mb-4">
      <i class="fas fa-user-circle text-brand-primary-600"></i>
      <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">{{ "requesterInformation" | i18n }}</h3>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Cliente -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="client_name">
          <i class="fas fa-user text-brand-primary-500 mr-2 text-xs"></i>
          {{ "client" | i18n }}
        </label>
        <div class="relative">
          <input
            id="client_name"
            type="text"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [ngClass]="
              touched.client_name
                ? !validFields().client_name && client_name()
                  ? 'border-red-500'
                  : validFields().client_name && client_name()
                  ? 'border-green-500'
                  : ''
                : ''
            "
            [value]="client_name()"
            (input)="
              updateField('client_name', $event.target.value); touched.client_name = true
            "
            required
            minlength="3"
            [placeholder]="'clientNamePlaceholder' | i18n"
            aria-label="{{ 'client' | i18n }}"
            aria-describedby="client_name-error"
            [attr.aria-invalid]="
              touched.client_name && !validFields().client_name ? 'true' : null
            "
          />
          <span
            *ngIf="touched.client_name && validFields().client_name && client_name()"
            class="absolute right-3 top-2.5 text-green-500 dark:text-green-400"
          >
            <i class="fas fa-check-circle"></i>
          </span>
          <span
            *ngIf="touched.client_name && !validFields().client_name && client_name()"
            class="absolute right-3 top-2.5 text-red-500 dark:text-red-400"
          >
            <i class="fas fa-exclamation-circle"></i>
          </span>
        </div>
        <span
          *ngIf="touched.client_name && !validFields().client_name && client_name()"
          id="client_name-error"
          class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          role="alert"
        >
          <i class="fas fa-info-circle mr-1"></i>
          {{ "clientNameMinLength" | i18n }}
        </span>
      </div>

      <!-- Telefone -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="client_phone">
          <i class="fas fa-phone text-brand-primary-500 mr-2 text-xs"></i>
          {{ "phone" | i18n }}
        </label>
        <div class="relative">
          <input
            id="client_phone"
            type="tel"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [ngClass]="
              touched.client_phone
                ? !validFields().client_phone && client_phone()
                  ? 'border-red-500'
                  : validFields().client_phone && client_phone()
                  ? 'border-green-500'
                  : ''
                : ''
            "
            [value]="client_phone()"
            (input)="
              updateField('client_phone', $event.target.value); touched.client_phone = true
            "
            required
            pattern="[0-9]{9}"
            maxlength="9"
            inputmode="numeric"
            [placeholder]="'phonePlaceholder' | i18n"
            autocomplete="tel"
            aria-label="{{ 'phone' | i18n }}"
            aria-describedby="client_phone-error"
            [attr.aria-invalid]="
              touched.client_phone && !validFields().client_phone ? 'true' : null
            "
          />
          <span
            *ngIf="touched.client_phone && validFields().client_phone && client_phone()"
            class="absolute right-3 top-2.5 text-green-500 dark:text-green-400"
          >
            <i class="fas fa-check-circle"></i>
          </span>
          <span
            *ngIf="touched.client_phone && !validFields().client_phone && client_phone()"
            class="absolute right-3 top-2.5 text-red-500 dark:text-red-400"
          >
            <i class="fas fa-exclamation-circle"></i>
          </span>
        </div>
        <span
          *ngIf="touched.client_phone && !validFields().client_phone && client_phone()"
          id="client_phone-error"
          class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          role="alert"
        >
          <i class="fas fa-info-circle mr-1"></i>
          {{ "invalidPhoneNumber" | i18n }}
        </span>
      </div>

      <!-- NIF (Opcional) -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="client_nif">
          <i class="fas fa-id-card text-brand-primary-500 mr-2 text-xs"></i>
          {{ "nif" | i18n }} <span class="text-gray-400 ml-1">({{ "optional" | i18n }})</span>
        </label>
        <div class="relative">
          <input
            id="client_nif"
            type="text"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [ngClass]="
              touched.client_nif && client_nif()
                ? !validFields().client_nif
                  ? 'border-red-500'
                  : 'border-green-500'
                : ''
            "
            [value]="client_nif()"
            (input)="
              updateField('client_nif', $event.target.value); touched.client_nif = true
            "
            pattern="[0-9]{9}"
            maxlength="9"
            inputmode="numeric"
            [placeholder]="'nifPlaceholder' | i18n"
            aria-label="{{ 'nif' | i18n }}"
            aria-describedby="client_nif-error"
            [attr.aria-invalid]="
              touched.client_nif && client_nif() && !validFields().client_nif ? 'true' : null
            "
          />
          <span
            *ngIf="touched.client_nif && client_nif() && validFields().client_nif"
            class="absolute right-3 top-2.5 text-green-500 dark:text-green-400"
          >
            <i class="fas fa-check-circle"></i>
          </span>
          <span
            *ngIf="touched.client_nif && client_nif() && !validFields().client_nif"
            class="absolute right-3 top-2.5 text-red-500 dark:text-red-400"
          >
            <i class="fas fa-exclamation-circle"></i>
          </span>
        </div>
        <span
          *ngIf="touched.client_nif && client_nif() && !validFields().client_nif"
          id="client_nif-error"
          class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          role="alert"
        >
          <i class="fas fa-info-circle mr-1"></i>
          {{ "invalidNIF" | i18n }}
        </span>
      </div>
    </div>

    <!-- Email do Cliente (Opcional) -->
    <div class="mt-4">
      <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="email_client">
        <i class="fas fa-envelope text-brand-primary-500 mr-2 text-xs"></i>
        {{ "email" | i18n }} <span class="text-gray-400 ml-1">({{ "optional" | i18n }})</span>
      </label>
      <div class="relative">
        <input
          id="email_client"
          type="email"
          class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          [ngClass]="
            touched.email_client && email_client()
              ? !validFields().email_client
                ? 'border-red-500'
                : 'border-green-500'
              : ''
          "
          [value]="email_client()"
          (input)="
            updateField('email_client', $event.target.value); touched.email_client = true
          "
          [placeholder]="'emailPlaceholder' | i18n"
          autocomplete="email"
          aria-label="{{ 'email' | i18n }}"
          aria-describedby="email_client-error"
          [attr.aria-invalid]="
            touched.email_client && email_client() && !validFields().email_client ? 'true' : null
          "
        />
        <span
          *ngIf="touched.email_client && validFields().email_client && email_client()"
          class="absolute right-3 top-2.5 text-green-500"
        >
          <i class="fas fa-check-circle"></i>
        </span>
        <span
          *ngIf="touched.email_client && email_client() && !validFields().email_client"
          class="absolute right-3 top-2.5 text-red-500"
        >
          <i class="fas fa-exclamation-circle"></i>
        </span>
      </div>
      <span
        *ngIf="touched.email_client && email_client() && !validFields().email_client"
        id="email_client-error"
        class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
        role="alert"
      >
        <i class="fas fa-info-circle mr-1"></i>
        {{ "invalidEmail" | i18n }}
      </span>
    </div>
  </div>

  <!-- SeÃ§Ã£o de Detalhes do ServiÃ§o -->
    <div class="p-6 bg-white dark:bg-gray-800">
      <div class="flex items-center gap-2 mb-4">
        <i class="fas fa-briefcase text-brand-primary-600"></i>
        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">{{ "serviceDetails" | i18n }}</h3>
      </div>
    
    <div class="space-y-4">
      <!-- TÃ­tulo -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="title">
          <i class="fas fa-heading text-brand-primary-500 mr-2 text-xs"></i>
          {{ "title" | i18n }}
        </label>
        <div class="relative">
          <input
            id="title"
            type="text"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [ngClass]="
              touched.title
                ? !validFields().title && title()
                  ? 'border-red-500'
                  : validFields().title && title()
                  ? 'border-green-500'
                  : ''
                : ''
            "
            [value]="title()"
            (input)="
              updateField('title', $event.target.value); touched.title = true
            "
            required
            minlength="3"
            [placeholder]="'titlePlaceholder' | i18n"
            aria-label="{{ 'title' | i18n }}"
            aria-describedby="title-error"
            [attr.aria-invalid]="
              touched.title && !validFields().title ? 'true' : null
            "
          />
          <span
            *ngIf="touched.title && validFields().title && title()"
            class="absolute right-3 top-2.5 text-green-500 dark:text-green-400"
          >
            <i class="fas fa-exclamation-circle"></i>
          </span>
        </div>
        <span
          *ngIf="touched.title && !validFields().title && title()"
          id="title-error"
          class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          role="alert"
        >
          <i class="fas fa-info-circle mr-1"></i>
          {{ "titleMinLength" | i18n }}
        </span>
      </div>

      <!-- DescriÃ§Ã£o -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="description">
          <i class="fas fa-align-left text-brand-primary-500 mr-2 text-xs"></i>
          {{ "description" | i18n }}
        </label>
        <div class="relative">
          <textarea
            id="description"
            rows="4"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all resize-none bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [ngClass]="
              touched.description
                ? !validFields().description && description()
                  ? 'border-red-500'
                  : validFields().description && description()
                  ? 'border-green-500'
                  : ''
                : ''
            "
            [value]="description()"
            (input)="
              updateField('description', $event.target.value);
              touched.description = true
            "
            required
            minlength="10"
            [placeholder]="'descriptionPlaceholder' | i18n"
            aria-label="{{ 'description' | i18n }}"
            aria-describedby="description-error"
            [attr.aria-invalid]="
              touched.description && !validFields().description ? 'true' : null
            "
          ></textarea>
          <span
            *ngIf="touched.description && validFields().description && description()"
            class="absolute right-3 top-2.5 text-green-500"
          >
            <i class="fas fa-check-circle"></i>
          </span>
          <span
            *ngIf="
              touched.description && !validFields().description && description()
            "
            class="absolute right-3 top-2.5 text-red-500"
          >
            <i class="fas fa-exclamation-circle"></i>
          </span>
        </div>
        <span
          *ngIf="touched.description && !validFields().description && description()"
          id="description-error"
          class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          role="alert"
        >
          <i class="fas fa-info-circle mr-1"></i>
          {{ "descriptionMinLength" | i18n }}
        </span>
      </div>

      <!-- Data/Hora Preferida e Prioridade na mesma linha -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Data/Hora solicitada -->
        <div>
          <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="requestedDateTime">
            <i class="fas fa-calendar-alt text-brand-primary-500 mr-2 text-xs"></i>
            {{ "preferredDateTime" | i18n }}
          </label>
          <div class="relative">
            <input
              id="requestedDateTime"
              type="datetime-local"
              class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
              [ngClass]="
                touched.requestedDateTime
                  ? !validFields().requestedDateTime && requestedDateTime()
                    ? 'border-red-500'
                    : validFields().requestedDateTime && requestedDateTime()
                    ? 'border-green-500'
                    : ''
                  : ''
              "
              [value]="requestedDateTime()"
              (input)="
                updateField('requestedDateTime', $event.target.value);
                touched.requestedDateTime = true
              "
              required
              [placeholder]="'dateTimePlaceholder' | i18n"
              aria-label="{{ 'dateTime' | i18n }}"
              aria-describedby="requestedDateTime-error"
              [attr.aria-invalid]="
                touched.requestedDateTime && !validFields().requestedDateTime
                  ? 'true'
                  : null
              "
            />
            <span
              *ngIf="touched.requestedDateTime && validFields().requestedDateTime && requestedDateTime()"
              class="absolute right-3 top-2.5 text-green-500"
            >
              <i class="fas fa-check-circle"></i>
            </span>
            <span
              *ngIf="
                touched.requestedDateTime &&
                !validFields().requestedDateTime &&
                requestedDateTime()
              "
              class="absolute right-3 top-2.5 text-red-500"
            >
              <i class="fas fa-exclamation-circle"></i>
            </span>
          </div>
          <span
            *ngIf="
              touched.requestedDateTime &&
              !validFields().requestedDateTime &&
              requestedDateTime()
            "
            id="requestedDateTime-error"
            class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
            role="alert"
          >
            <i class="fas fa-info-circle mr-1"></i>
            {{ "validFutureDateTime" | i18n }}
          </span>
        </div>

        <!-- Prioridade -->
        <div>
          <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="priority">
            <i class="fas fa-exclamation-triangle text-brand-primary-500 mr-2 text-xs"></i>
            {{ "priority" | i18n }}
          </label>
          <select
            id="priority"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
            [value]="priority() || ''"
            (change)="updateField('priority', $any($event.target).value)"
            required
          >
            <option value="" disabled selected>{{ "select" | i18n }}</option>
            <option value="Normal">{{ "priorityNormal" | i18n }}</option>
            <option value="Urgent">{{ "priorityUrgent" | i18n }}</option>
          </select>
          <span
            *ngIf="!validFields().priority && priority()"
            class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          >
            <i class="fas fa-exclamation-circle mr-1"></i>
            {{ "selectPriority" | i18n }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- SeÃ§Ã£o de EndereÃ§o -->
    <div class="p-6 bg-white dark:bg-gray-800">
      <div class="flex items-center gap-2 mb-4">
        <i class="fas fa-map-marker-alt text-brand-primary-600"></i>
        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">{{ "address" | i18n }}</h3>
      </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- CÃ³digo Postal -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="zip_code">
          <i class="fas fa-mail-bulk text-brand-primary-500 mr-2 text-xs"></i>
          {{ "postalCode" | i18n }}
        </label>
        <div class="relative">
          <input
            id="zip_code"
            type="text"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
            [ngClass]="
              touched.zip_code
                ? !validFields().zip_code && zip_code()
                  ? 'border-red-500'
                  : validFields().zip_code && zip_code()
                  ? 'border-green-500'
                  : ''
                : ''
            "
            [value]="zip_code()"
            (input)="
              updateField('zip_code', $event.target.value);
              touched.zip_code = true
            "
            (paste)="onZipCodePaste($event)"
            required
            pattern="\d{4}-\d{3}"
            maxlength="8"
            inputmode="numeric"
            [placeholder]="'postalCodePlaceholder' | i18n"
            autocomplete="postal-code"
            aria-label="{{ 'postalCode' | i18n }}"
            aria-describedby="zip_code-error"
            [attr.aria-invalid]="
              touched.zip_code && !validFields().zip_code ? 'true' : null
            "
          />
          <span
            *ngIf="touched.zip_code && validFields().zip_code && zip_code()"
            class="absolute right-3 top-2.5 text-green-500"
          >
            <i class="fas fa-check-circle"></i>
          </span>
          <span
            *ngIf="touched.zip_code && !validFields().zip_code && zip_code()"
            class="absolute right-3 top-2.5 text-red-500"
          >
            <i class="fas fa-exclamation-circle"></i>
          </span>
        </div>
        <span
          *ngIf="touched.zip_code && !validFields().zip_code && zip_code()"
          id="zip_code-error"
          class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1"
          role="alert"
        >
          <i class="fas fa-info-circle mr-1"></i>
          {{ formError() ? formError() : ("invalidPostalCode" | i18n) }}
        </span>
      </div>

      <!-- Logradouro -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 mb-2" for="street">
          <i class="fas fa-road text-brand-primary-500 mr-2 text-xs"></i>
          {{ "logradouro" | i18n }}
        </label>
        <!-- Campo somente leitura quando hÃ¡ logradouro do cÃ³digo postal -->
        @if (hasStreetFromPostalCode()) {
          <input
            id="street"
            type="text"
            class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-gray-50 dark:bg-gray-700 cursor-not-allowed text-gray-900 dark:text-gray-100"
            [value]="street()"
            readonly
            required
            minlength="5"
            [placeholder]="'streetPlaceholder' | i18n"
            aria-label="{{ 'logradouro' | i18n }}"
            tabindex="0"
            aria-readonly="true"
          />
        }
        <!-- Campo editÃ¡vel quando NÃƒO hÃ¡ logradouro do cÃ³digo postal -->
        @else {
          <div class="relative">
            <input
              id="street_manual"
              type="text"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
              [ngClass]="
                touched.street
                  ? street_manual() && street_manual().length > 0 && !validFields().street_manual
                    ? 'border-red-500'
                    : validFields().street_manual && street_manual()
                    ? 'border-green-500'
                    : ''
                  : ''
              "
              [value]="street_manual()"
              (input)="updateField('street_manual', $any($event.target).value)"
              (blur)="touched.street = true"
              required
              minlength="5"
              [placeholder]="'streetPlaceholder' | i18n"
              aria-label="{{ 'logradouro' | i18n }}"
            />
            @if (touched.street && street_manual() && street_manual().length > 0 && !validFields().street_manual) {
              <i class="fas fa-exclamation-circle absolute right-3 top-3 text-red-500 dark:text-red-400"></i>
            }
            @if (touched.street && validFields().street_manual && street_manual()) {
              <i class="fas fa-check-circle absolute right-3 top-3 text-green-500 dark:text-green-400"></i>
            }
          </div>
          <p class="text-xs text-amber-600 dark:text-amber-400 mt-1">
            <i class="fas fa-info-circle mr-1"></i>
            {{ "streetManualInfo" | i18n }}
          </p>
        }
      </div>

      <!-- NÃºmero -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 mb-2" for="number">
          <i class="fas fa-hashtag text-brand-primary-500 mr-2 text-xs"></i>
          {{ "number" | i18n }}
        </label>
        <div class="relative">
          <input
            id="number"
            type="text"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
            [ngClass]="
              touched.number
                ? number() && number().length > 0 && !validFields().number
                  ? 'border-red-500'
                  : validFields().number && number()
                  ? 'border-green-500'
                  : ''
                : ''
            "
            [value]="number()"
            (input)="
              updateField('number', $event.target.value); touched.number = true
            "
            required
            [placeholder]="'numberPlaceholder' | i18n"
            aria-label="{{ 'number' | i18n }}"
            aria-describedby="number-error"
            [attr.aria-invalid]="
              touched.number && number() && !validFields().number ? 'true' : null
            "
          />
          @if (validFields().number && number()) {
          <span
            class="absolute right-3 top-2.5 text-green-500 dark:text-green-400"
          >
            <i class="fas fa-check-circle"></i>
          </span>
          }
          @if (touched.number && number() && !validFields().number) {
          <span
            class="absolute right-3 top-2.5 text-red-500 dark:text-red-400"
          >
            <i class="fas fa-exclamation-circle"></i>
          </span>
          }
        </div>
      </div>

      <!-- Complemento -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="complement">
          <i class="fas fa-building text-brand-primary-500 mr-2 text-xs"></i>
          {{ "complement" | i18n }}
        </label>
        <input
          id="complement"
          type="text"
          class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          [value]="complement()"
          (input)="updateField('complement', $event.target.value)"
          [placeholder]="'complementPlaceholder' | i18n"
        />
      </div>

      <!-- Localidade -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="locality">
          <i class="fas fa-city text-brand-primary-500 mr-2 text-xs"></i>
          {{ "locality" | i18n }}
        </label>
        <input
          id="locality"
          type="text"
          class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-gray-50 dark:bg-gray-700 cursor-not-allowed text-gray-900 dark:text-gray-100"
          [value]="locality()"
          readonly
          [placeholder]="'localityPlaceholder' | i18n"
          aria-label="{{ 'locality' | i18n }}"
          tabindex="0"
          aria-readonly="true"
        />
      </div>

      <!-- Concelho -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="city">
          <i class="fas fa-map text-brand-primary-500 mr-2 text-xs"></i>
          {{ "concelho" | i18n }}
        </label>
        <input
          id="city"
          type="text"
          class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-gray-50 dark:bg-gray-700 cursor-not-allowed text-gray-900 dark:text-gray-100"
          [value]="county()"
          readonly
          [placeholder]="'cityPlaceholder' | i18n"
          aria-label="{{ 'concelho' | i18n }}"
          tabindex="0"
          aria-readonly="true"
        />
        <span *ngIf="!validFields().city && city()" class="text-xs text-red-500 dark:text-red-400 flex items-center mt-1">
          <i class="fas fa-exclamation-circle mr-1"></i>
          {{ "cityMinLength" | i18n }}
        </span>
      </div>

      <!-- Distrito -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="district">
          <i class="fas fa-map-marked-alt text-brand-primary-500 mr-2 text-xs"></i>
          {{ "district" | i18n }}
        </label>
        <input
          id="district"
          type="text"
          class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-gray-50 dark:bg-gray-700 cursor-not-allowed text-gray-900 dark:text-gray-100\"
          [value]="district()"
          readonly
          [placeholder]="'districtPlaceholder' | i18n"
          aria-label="{{ 'district' | i18n }}"
          tabindex="0"
          aria-readonly="true"
        />
      </div>

      <!-- Latitude -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 mb-2" for="latitude">
          <i class="fas fa-globe text-brand-primary-500 mr-2 text-xs"></i>
          Latitude
        </label>
        <input
          id="latitude"
          type="number"
          step="0.000001"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
          [value]="latitude()"
          (input)="updateField('latitude', $event.target.value)"
          [placeholder]="'latitude'"
          aria-label="Latitude"
        />
      </div>

      <!-- Longitude -->
      <div>
        <label class="flex items-center text-sm font-semibold text-gray-700 mb-2" for="longitude">
          <i class="fas fa-globe text-brand-primary-500 mr-2 text-xs"></i>
          Longitude
        </label>
        <input
          id="longitude"
          type="number"
          step="0.000001"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-primary-500 focus:border-brand-primary-500 transition-all"
          [value]="longitude()"
          (input)="updateField('longitude', $event.target.value)"
          [placeholder]="'longitude'"
          aria-label="Longitude"
        />
      </div>
    </div>
  </div>

  <!-- SeÃ§Ã£o de Mensagens e BotÃµes -->
  <div class="p-6 bg-white">
    <!-- Mensagens de erro/sucesso -->
    <div *ngIf="formError()" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
      <div class="flex items-center text-red-800">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        <span class="text-sm font-medium">{{ formError() }}</span>
      </div>
    </div>
  <div *ngIf="formSuccess()" class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
    <div class="flex items-center text-green-800">
      <i class="fas fa-check-circle mr-2"></i>
      <span class="text-sm font-medium">{{ formSuccess() }}</span>
    </div>
  </div>

  <!-- BotÃµes de AÃ§Ã£o -->
  <div class="flex flex-col sm:flex-row justify-between items-center gap-4 pt-6 border-t border-gray-200">
    <!-- Status de ValidaÃ§Ã£o -->
    <div class="flex items-center gap-2">
      <span
        class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-semibold"
        [ngClass]="isFormValid() ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
      >
        <i [class]="isFormValid() ? 'fas fa-check-circle mr-1' : 'fas fa-times-circle mr-1'"></i>
        {{ isFormValid() ? ("formValid" | i18n) : ("formInvalid" | i18n) }}
      </span>
    </div>

    <!-- BotÃµes -->
    <div class="flex gap-3">
      <button
        type="button"
        class="px-6 py-2.5 rounded-lg border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 transition-all duration-200 flex items-center gap-2"
        (click)="onCancelClick()"
      >
        <i class="fas fa-times"></i>
        {{ "cancel" | i18n }}
      </button>
      <button
        type="submit"
        class="px-6 py-2.5 rounded-lg bg-gradient-to-r from-brand-primary-600 to-brand-primary-500 text-white font-semibold hover:from-brand-primary-700 hover:to-brand-primary-600 transition-all duration-200 flex items-center justify-center gap-2 min-w-[140px] shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
        [disabled]="!isFormValid() || isSubmitting()"
      >
        <i class="fas fa-paper-plane"></i>
        {{ "submit" | i18n }}
      </button>
    </div>
  </div>
  </div>
  </div>
</form>



