<div
  class="flex items-center justify-center min-h-screen bg-gradient-to-br from-brand-primary-100 via-white to-brand-primary-300 mobile-safe"
  aria-label="Tela de login"
>
  <div
    class="w-full max-w-md md:max-w-lg lg:max-w-xl p-4 md:p-8 space-y-8 bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl relative border border-brand-primary-100 transition-all duration-300"
    aria-labelledby="login-title"
  >
    <button
      (click)="switchToLanding.emit()"
      class="absolute top-3 left-3 text-brand-primary-400 hover:text-brand-primary-700 flex items-center focus:outline-none focus:ring-2 focus:ring-brand-primary-400 bg-white/80 px-2 py-1 rounded-lg shadow-sm"
    >
      <i class="fas fa-arrow-left mr-2" aria-hidden="true"></i>
      <span class="hidden sm:inline">{{ "backToHome" | i18n }}</span>
    </button>

    <div class="flex flex-col items-center pt-4 pb-2 gap-2">
      <img
        src="src/assets/logo-new.png"
        alt="Logo HomeService"
        class="h-16 w-16 md:h-20 md:w-20 rounded-full shadow-lg mb-2"
      />
      <h1
        id="login-title"
        class="text-3xl md:text-4xl font-extrabold text-brand-primary-700 drop-shadow-sm"
      >
        {{ "signIn" | i18n }}
      </h1>
      <p class="mt-2 text-base text-brand-primary-400 font-medium">
        {{ "welcomeBack" | i18n }}
      </p>
    </div>

    <!-- Spinner centralizado -->
    @if (isLoading()) {
    <div class="absolute inset-0 flex items-center justify-center bg-white/70 z-10 rounded-3xl">
      <i class="fas fa-spinner fa-spin text-brand-primary-500 text-4xl" aria-label="Carregando"></i>
    </div>
    }

    <form (ngSubmit)="login()" class="space-y-7" autocomplete="off" aria-describedby="login-error">
      <!-- Mensagem de Erro -->
      @if (errorMessage()) {
      <div
        id="login-error"
        class="p-3 bg-semantic-error/10 border border-semantic-error text-semantic-error rounded-md"
        role="alert"
        aria-live="assertive"
      >
        <div class="flex items-center">
          <i class="fas fa-exclamation-circle mr-2" aria-hidden="true"></i>
          <span>{{ errorMessage() | i18n }}</span>
        </div>
      </div>
      }

      <div>
        <label
          for="email"
          class="block text-sm font-semibold text-brand-primary-700 mb-1"
          >{{ "email" | i18n }}</label
        >
        <input
          id="email"
          name="email"
          type="email"
          autocomplete="email"
          required
          aria-required="true"
          [attr.aria-invalid]="emailInvalid() ? 'true' : 'false'"
          aria-describedby="email-error"
          class="w-full px-4 py-2 border rounded-lg shadow-sm placeholder-brand-primary-300 focus:outline-none focus:ring-2 focus:ring-brand-primary-400 focus:border-brand-primary-400 transition-all duration-150 bg-brand-primary-50/40"
          [ngClass]="{ 'border-red-400': emailInvalid(), 'border-brand-primary-200': !emailInvalid() }"
          [ngModel]="email()"
          (ngModelChange)="email.set($event)"
          (blur)="validateEmail()"
        />
        @if (emailInvalid()) {
        <span id="email-error" class="text-xs text-red-600 mt-1 block" role="alert">{{ "invalidEmail" | i18n }}</span>
        }
      </div>

      <div>
        <label
          for="password"
          class="block text-sm font-semibold text-brand-primary-700 mb-1"
          >{{ "password" | i18n }}</label
        >
        <div class="relative">
          <input
            id="password"
            name="password"
            [type]="showPassword ? 'text' : 'password'"
            autocomplete="off"
            required
            aria-required="true"
            [attr.aria-invalid]="passwordInvalid() ? 'true' : 'false'"
            aria-describedby="password-error"
            class="w-full px-4 py-2 border rounded-lg shadow-sm placeholder-brand-primary-300 focus:outline-none focus:ring-2 focus:ring-brand-primary-400 focus:border-brand-primary-400 transition-all duration-150 bg-brand-primary-50/40"
            [ngClass]="{ 'border-red-400': passwordInvalid(), 'border-brand-primary-200': !passwordInvalid() }"
            [ngModel]="password()"
            (ngModelChange)="password.set($event)"
            (blur)="validatePassword()"
          />
          <button
            type="button"
            (click)="toggleShowPassword()"
            class="absolute right-2 top-2 text-brand-primary-400 hover:text-brand-primary-700 focus:outline-none focus:ring-2 focus:ring-brand-primary-400 bg-white/80 px-2 py-1 rounded-lg"
            [attr.aria-label]="showPassword ? 'Ocultar senha' : 'Mostrar senha'"
          >
            <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'" aria-hidden="true"></i>
          </button>
        </div>
        @if (passwordInvalid()) {
        <span id="password-error" class="text-xs text-red-600 mt-1 block" role="alert">{{ "invalidPassword" | i18n }}</span>
        }
      </div>

      <div class="flex items-center justify-between mt-2">
        <button
          type="button"
          (click)="handleForgotPassword()"
          class="text-sm font-semibold text-brand-primary-500 hover:text-brand-primary-700 focus:outline-none focus:ring-2 focus:ring-brand-primary-400 px-2 py-1 rounded-lg"
        >
          {{ 'forgotPassword' | i18n }}
        </button>
      </div>

      <div>
        <button
          type="submit"
          [disabled]="!email() || !password() || isLoading() || emailInvalid() || passwordInvalid()"
          class="w-full flex justify-center py-2 px-4 border border-transparent rounded-xl shadow-md text-base font-bold text-white bg-gradient-to-r from-brand-primary-500 via-brand-primary-600 to-brand-primary-700 hover:from-brand-primary-600 hover:to-brand-primary-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary-400 disabled:bg-brand-primary-300 disabled:cursor-not-allowed transition-all duration-150"
        >
          {{ "login" | i18n }}
        </button>
      </div>
    </form>

    <div class="mt-6 text-sm text-center text-brand-primary-500">
      <span>{{ "dontHaveAccount" | i18n }}</span>
      <button
        (click)="switchToRegister.emit()"
        class="font-bold text-brand-primary-600 hover:text-brand-primary-800 ml-1 focus:outline-none focus:ring-2 focus:ring-brand-primary-400 px-2 py-1 rounded-lg"
      >
        {{ "createAccount" | i18n }}
      </button>
    </div>
