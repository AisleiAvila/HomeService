<!-- Admin Dashboard Main Container -->
<div class="flex flex-col h-full bg-gray-100">
  <!-- Navigation Tabs -->
  <div class="flex-shrink-0 border-b-2 border-gray-200 bg-white shadow-sm">
    <!-- Mobile Dropdown Menu (visible only on very small screens) -->
    <div class="block sm:hidden px-4 py-3">
      <select
        [value]="currentView()"
        (change)="setView($any($event.target).value)"
        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
      >
        @for (view of views(); track view.id) {
        <option [value]="view.id">
          {{ view.label }}
          @if (view.id === 'approvals' && pendingApprovalCount() > 0) { ({{
            pendingApprovalCount()
          }}) }
        </option>
        }
      </select>
    </div>

    <!-- Horizontal Scrollable Menu (visible on small+ screens) -->
    <nav
      class="hidden sm:flex overflow-x-auto -mb-px px-4 sm:px-6 scrollbar-hide"
    >
      <div class="flex space-x-4 sm:space-x-6 min-w-max">
        @for (view of views(); track view.id) {
        <button
          (click)="setView(view.id)"
          [class]="
            'whitespace-nowrap py-3 px-3 sm:py-4 sm:px-1 border-b-2 font-medium text-xs sm:text-sm transition-colors duration-200 flex-shrink-0 min-w-[80px] sm:min-w-0 ' +
            (currentView() === view.id
              ? 'border-indigo-500 text-indigo-600'
              : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300')
          "
          class="flex items-center justify-center sm:justify-start"
        >
          <i [class]="view.icon + ' sm:mr-2'" class="text-sm sm:text-base"></i>
          <span class="hidden md:inline ml-1 sm:ml-0">{{ view.label }}</span>
          @if (view.id === 'approvals' && pendingApprovalCount() > 0) {
          <span
            class="ml-1 sm:ml-2 inline-flex items-center px-1.5 py-0.5 sm:px-2.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800"
          >
            {{ pendingApprovalCount() }}
          </span>
          }
        </button>
        }
      </div>
    </nav>
  </div>

  <!-- Content Area -->
  <div class="flex-1 overflow-y-auto p-3 sm:p-4 lg:p-6">
    @switch (currentView()) { @case ('overview') {
    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6"
    >
      @for (stat of stats(); track stat.label) {
      <div
        class="bg-white p-6 rounded-lg shadow-md flex items-center space-x-4"
      >
        <div
          class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full"
          [class]="stat.bgColor"
        >
          <i class="text-2xl" [class]="stat.icon"></i>
        </div>
        <div>
          <h3 class="text-gray-500 text-sm font-medium">{{ stat.label }}</h3>
          <p class="text-2xl font-bold text-gray-800 mt-1">{{ stat.value }}</p>
        </div>
      </div>
      }
    </div>
    <div class="mt-8">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">
        {{ "pendingActions" | i18n }}
      </h3>
      @if(actionableRequests().length > 0) {

      <!-- Desktop Table View -->
      <div
        class="hidden lg:block bg-white rounded-lg shadow-md overflow-hidden"
      >
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "request" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "client" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "status" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "actions" | i18n }}
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for(req of actionableRequests(); track req.id) {
            <tr>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
              >
                {{ req.title }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ getClientName(req.client_id) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span [class]="statusClass(req.status)">{{ req.status }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <div class="flex gap-2 items-center">
                  @if(req.status === 'Pending' || req.status === 'Quoted') {
                  <button
                    (click)="selectRequestForQuote(req)"
                    class="p-2 text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded-full transition-colors duration-200"
                    title="{{
                      req.status === 'Quoted'
                        ? ('viewQuote' | i18n)
                        : ('provideQuote' | i18n)
                    }}"
                  >
                    <i class="fas fa-calculator"></i>
                  </button>
                  } @if(req.status === 'Approved') {
                  <button
                    (click)="selectRequestForAssignment(req)"
                    class="p-2 text-green-600 hover:text-green-800 hover:bg-green-50 rounded-full transition-colors duration-200"
                    title="{{ 'assignProfessional' | i18n }}"
                  >
                    <i class="fas fa-user-plus"></i>
                  </button>
                  }
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="lg:hidden space-y-4">
        @for(req of actionableRequests(); track req.id) {
        <div class="bg-white rounded-lg shadow-md p-4 border border-gray-200">
          <div class="space-y-3">
            <!-- Header with title and status -->
            <div class="flex justify-between items-start">
              <h4 class="text-sm font-semibold text-gray-900 flex-1 mr-2">
                {{ req.title }}
              </h4>
              <span [class]="statusClass(req.status)" class="flex-shrink-0">
                {{ req.status }}
              </span>
            </div>

            <!-- Client info -->
            <div class="text-sm text-gray-600">
              <span class="font-medium">{{ "client" | i18n }}:</span>
              {{ getClientName(req.client_id) }}
            </div>

            <!-- Actions -->
            <div class="pt-2 border-t border-gray-100">
              <div class="flex flex-wrap gap-2">
                @if(req.status === 'Pending' || req.status === 'Quoted') {
                <button
                  (click)="selectRequestForQuote(req)"
                  class="flex-1 min-w-[120px] px-3 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md transition-colors duration-200"
                >
                  {{
                    req.status === "Quoted"
                      ? ("viewQuote" | i18n)
                      : ("provideQuote" | i18n)
                  }}
                </button>
                } @if(req.status === 'Approved') {
                <button
                  (click)="selectRequestForAssignment(req)"
                  class="flex-1 min-w-[120px] px-3 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-md transition-colors duration-200"
                >
                  {{ "assign" | i18n }}
                </button>
                }
              </div>
            </div>
          </div>
        </div>
        }
      </div>

      } @else {
      <p class="text-center text-gray-500 p-6 bg-white rounded-lg shadow-md">
        {{ "noRequestsNeedAttention" | i18n }}
      </p>
      }
    </div>
    } @case ('requests') {
    <div class="bg-white rounded-lg shadow-md overflow-hidden table-responsive">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "service" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "client" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "professional" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "status" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "cost" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "actions" | i18n }}
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for(req of allRequests(); track req.id) {
          <tr>
            <td
              class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
            >
              {{ req.title }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ getClientName(req.client_id) }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ getProfessionalName(req.professional_id) }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <span [class]="statusClass(req.status)">{{ req.status }}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ req.cost ? "€" + (req.cost | number : "1.2-2") : "N/A" }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <div class="flex gap-2 items-center">
                @if(req.status === 'Pending' || req.status === 'Quoted') {
                <button
                  (click)="selectRequestForQuote(req)"
                  class="p-2 text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded-full transition-colors duration-200"
                  title="{{ 'provideQuote' | i18n }}"
                >
                  <i class="fas fa-calculator"></i>
                </button>
                } @if(req.status === 'Approved') {
                <button
                  (click)="selectRequestForAssignment(req)"
                  class="p-2 text-green-600 hover:text-green-800 hover:bg-green-50 rounded-full transition-colors duration-200"
                  title="{{ 'assignProfessional' | i18n }}"
                >
                  <i class="fas fa-user-plus"></i>
                </button>
                }

                <!-- Always Available Actions -->
                <button
                  (click)="viewRequestDetails(req)"
                  class="p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-full transition-colors duration-200"
                  title="{{ 'viewRequestDetails' | i18n }}"
                >
                  <i class="fas fa-eye"></i>
                </button>
                <button
                  (click)="openChat(req)"
                  class="p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-full transition-colors duration-200"
                  title="{{ 'chat' | i18n }}"
                >
                  <i class="fas fa-comments"></i>
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @case ('approvals') {
    <div class="bg-white rounded-lg shadow-md overflow-hidden table-responsive">
      <h3 class="text-xl font-semibold text-gray-800 p-4 border-b">
        {{ "pendingRegistrations" | i18n }}
      </h3>
      @if(pendingRegistrations().length > 0) {
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "name" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "email" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "phone" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "actions" | i18n }}
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for(user of pendingRegistrations(); track user.id) {
          <tr>
            <td
              class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
            >
              {{ user.name }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ user.email }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ user.phone }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <div class="flex gap-2 items-center">
                <button
                  (click)="approveClient(user.id)"
                  class="p-2 text-green-600 hover:text-green-800 hover:bg-green-50 rounded-full transition-colors duration-200"
                  title="{{ 'approve' | i18n }}"
                >
                  <i class="fas fa-check"></i>
                </button>
                <button
                  (click)="rejectClient(user.id)"
                  class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-full transition-colors duration-200"
                  title="{{ 'reject' | i18n }}"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
      } @else {
      <p class="text-center text-gray-500 p-6">
        {{ "noPendingRegistrations" | i18n }}
      </p>
      }
    </div>
    } @case ('finances') { @if(financialStats(); as stats) {
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
      <div class="bg-white p-4 rounded-lg shadow">
        <h4 class="text-sm font-medium text-gray-500">
          {{ "completedServices" | i18n }}
        </h4>
        <p class="text-2xl font-bold">{{ stats.completedServices }}</p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow">
        <h4 class="text-sm font-medium text-gray-500">
          {{ "totalRevenue" | i18n }}
        </h4>
        <p class="text-2xl font-bold text-green-600">
          {{ formatCost(stats.totalRevenue) }}
        </p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow">
        <h4 class="text-sm font-medium text-gray-500">
          {{ "totalTax" | i18n }}
        </h4>
        <p class="text-2xl font-bold">{{ formatCost(stats.totalTax) }}</p>
      </div>
      <div class="bg-white p-4 rounded-lg shadow">
        <h4 class="text-sm font-medium text-gray-500">
          {{ "outstandingAmount" | i18n }}
        </h4>
        <p class="text-2xl font-bold text-orange-600">
          {{ formatCost(stats.outstandingAmount) }}
        </p>
      </div>
    </div>
    }
    <div class="bg-white rounded-lg shadow-md overflow-hidden table-responsive">
      <div class="p-4 border-b flex justify-between items-center">
        <h3 class="text-xl font-semibold">{{ "financialDetails" | i18n }}</h3>
        <button
          (click)="exportToCSV()"
          class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"
        >
          <i class="fas fa-file-csv mr-2"></i>{{ "exportToCsv" | i18n }}
        </button>
      </div>
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "service" | i18n }}
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "client" | i18n }}
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "professional" | i18n }}
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "date" | i18n }}
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "payment" | i18n }}
            </th>
            <th
              class="px-4 py-3 text-right text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "total" | i18n }}
            </th>
            <th
              class="px-4 py-3 text-center text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "action" | i18n }}
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for(req of completedRequests(); track req.id) {
          <tr>
            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
              {{ req.title }}
            </td>
            <td class="px-4 py-4 whitespace-nowrap text-sm">
              {{ getClientName(req.client_id) }}
            </td>
            <td class="px-4 py-4 whitespace-nowrap text-sm">
              {{ getProfessionalName(req.professional_id) }}
            </td>
            <td class="px-4 py-4 whitespace-nowrap text-sm">
              {{ req.scheduled_date | date }}
            </td>
            <td
              class="px-4 py-4 whitespace-nowrap text-sm font-semibold"
              [class.text-green-600]="req.payment_status === 'Paid'"
              [class.text-orange-600]="req.payment_status === 'Unpaid'"
            >
              {{ req.payment_status }}
            </td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-right">
              {{ formatCost(req.cost) }}
            </td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-center">
              <button
                (click)="generateInvoice(req)"
                class="p-2 text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded-full transition-colors duration-200"
                title="{{ 'generateInvoice' | i18n }}"
              >
                <i class="fas fa-file-invoice"></i>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @case ('professionals') {
    <div class="bg-white rounded-lg shadow-md table-responsive">
      <div class="p-4 border-b flex justify-between items-center">
        <h3 class="text-xl font-semibold">
          {{ "manageProfessionals" | i18n }}
        </h3>
        <button
          (click)="showAddProfessionalForm.set(true)"
          class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700"
        >
          <i class="fas fa-plus mr-2"></i>{{ "addProfessional" | i18n }}
        </button>
      </div>
      @if(showAddProfessionalForm()) {
      <div class="p-4 border-b bg-gray-50">
        <h4 class="text-lg font-medium mb-2">
          {{ "addNewProfessional" | i18n }}
        </h4>
        <div class="space-y-4">
          <input
            type="text"
            [(ngModel)]="newProfessionalName"
            [placeholder]="'name' | i18n"
            class="w-full p-2 border rounded-md"
          />
          <input
            type="email"
            [(ngModel)]="newProfessionalEmail"
            [placeholder]="'email' | i18n"
            class="w-full p-2 border rounded-md"
          />
          <fieldset>
            <legend class="text-sm font-medium">
              {{ "specialties" | i18n }}
            </legend>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-2">
              @for(cat of allCategories(); track cat) {
              <div>
                <input
                  type="checkbox"
                  [id]="'new-pro-' + cat"
                  (change)="toggleNewProfessionalSpecialty(cat, $event)"
                /><label [for]="'new-pro-' + cat" class="ml-2">{{ cat }}</label>
              </div>
              }
            </div>
          </fieldset>
          <div class="flex justify-end space-x-2">
            <button
              (click)="resetNewProfessionalForm()"
              class="px-4 py-2 text-sm rounded-md bg-gray-200"
            >
              {{ "cancel" | i18n }}
            </button>
            <button
              (click)="addProfessional()"
              class="px-4 py-2 text-sm rounded-md text-white bg-green-600"
            >
              {{ "add" | i18n }}
            </button>
          </div>
        </div>
      </div>
      }
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "name" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "email" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "specialties" | i18n }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
            >
              {{ "action" | i18n }}
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for(pro of professionals(); track pro.id) {
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              {{ pro.name }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ pro.email }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              {{ pro.specialties?.join(", ") }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <button
                (click)="startEditProfessional(pro)"
                class="p-2 text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded-full transition-colors duration-200"
                title="{{ 'edit' | i18n }}"
              >
                <i class="fas fa-edit"></i>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @case ('categories') {
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="md:col-span-1 bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-4">
          {{ "addNewCategory" | i18n }}
        </h3>
        <div class="space-y-4">
          <div class="flex space-x-2">
            <input
              type="text"
              [(ngModel)]="newCategory"
              [placeholder]="'categoryName' | i18n"
              class="flex-grow p-2 border rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              (keydown.enter)="addCategory()"
            />
            <button
              (click)="addCategory()"
              [disabled]="!newCategory().trim()"
              class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-200"
            >
              {{ "add" | i18n }}
            </button>
          </div>
          @if (newCategory().trim() &&
          allCategories().includes(newCategory().trim())) {
          <p class="text-sm text-red-600">
            {{ "categoryAlreadyExists" | i18n }}
          </p>
          }
        </div>
      </div>
      <div class="md:col-span-2 bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-4">
          {{ "serviceCategories" | i18n }}
        </h3>
        @if (allCategories().length === 0) {
        <p class="text-gray-500 text-center py-8">No categories available</p>
        } @else {
        <ul class="divide-y divide-gray-200">
          @for(cat of allCategories(); track cat) {
          <li class="py-3 flex justify-between items-center">
            @if(editingCategory() === cat) {
            <input
              type="text"
              [(ngModel)]="editingCategoryName"
              class="p-2 border rounded-md flex-grow mr-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              (keydown.enter)="saveCategoryEdit()"
              (keydown.escape)="editingCategory.set(null)"
            />
            <div class="space-x-2 ml-2">
              <button
                (click)="saveCategoryEdit()"
                class="text-green-600 hover:text-green-800 p-1"
                title="Save"
              >
                <i class="fas fa-check"></i>
              </button>
              <button
                (click)="editingCategory.set(null)"
                class="text-gray-500 hover:text-gray-700 p-1"
                title="Cancel"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
            } @else {
            <span class="font-medium">{{ cat }}</span>
            <div class="space-x-4">
              <button
                (click)="startEditCategory(cat)"
                class="text-indigo-600 hover:text-indigo-900 text-sm font-medium"
              >
                {{ "edit" | i18n }}
              </button>
              <button
                (click)="deleteCategory(cat)"
                class="text-red-600 hover:text-red-900 text-sm font-medium"
              >
                {{ "delete" | i18n }}
              </button>
            </div>
            }
          </li>
          }
        </ul>
        }
      </div>
    </div>
    } @case ('clients') {
    <div class="bg-white rounded-lg shadow-md table-responsive">
      <div class="p-4 border-b">
        <h3 class="text-xl font-semibold">{{ "manageClients" | i18n }}</h3>
        <p class="text-gray-600 text-sm mt-1">
          {{ "clientManagementDescription" | i18n }}
        </p>
      </div>
      @if (clients().length > 0) {
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "name" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "email" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "phone" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "status" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "services" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "totalSpent" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "lastService" | i18n }}
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"
              >
                {{ "actions" | i18n }}
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for (client of clients(); track client.id) { @if
            (getClientStats(client.id); as stats) {
            <tr>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
              >
                <div class="flex items-center">
                  @if (client.avatar_url) {
                  <img
                    [src]="client.avatar_url"
                    [alt]="client.name"
                    class="h-8 w-8 rounded-full mr-3"
                  />
                  } @else {
                  <div
                    class="h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center mr-3"
                  >
                    <i class="fas fa-user text-gray-600 text-sm"></i>
                  </div>
                  }
                  <div>
                    <div class="font-medium">{{ client.name }}</div>
                    @if (client.email_verified === false) {
                    <div class="text-xs text-orange-600">
                      {{ "emailNotVerified" | i18n }}
                    </div>
                    }
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ client.email }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ client.phone || "N/A" }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span
                  class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                  [class.bg-green-100]="client.status === 'Active'"
                  [class.text-green-800]="client.status === 'Active'"
                  [class.bg-yellow-100]="client.status === 'Pending'"
                  [class.text-yellow-800]="client.status === 'Pending'"
                  [class.bg-red-100]="client.status === 'Rejected'"
                  [class.text-red-800]="client.status === 'Rejected'"
                >
                  {{ client.status }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <div class="text-center">
                  <div class="font-medium">{{ stats.completedRequests }}</div>
                  <div class="text-xs text-gray-400">
                    {{ "of" | i18n }} {{ stats.totalRequests }}
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <span class="font-medium text-green-600">
                  {{ formatCost(stats.totalSpent) }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                @if (stats.lastServiceDate) {
                <span>{{ stats.lastServiceDate | date : "short" }}</span>
                } @else {
                <span class="text-gray-400">{{ "never" | i18n }}</span>
                }
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <div class="flex gap-2 items-center">
                  @if (client.status === 'Active') {
                  <button
                    (click)="deactivateClient(client.id)"
                    class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-full transition-colors duration-200"
                    title="{{ 'deactivateClient' | i18n }}"
                  >
                    <i class="fas fa-user-times"></i>
                  </button>
                  } @else if (client.status === 'Rejected') {
                  <button
                    (click)="activateClient(client.id)"
                    class="p-2 text-green-600 hover:text-green-800 hover:bg-green-50 rounded-full transition-colors duration-200"
                    title="{{ 'activateClient' | i18n }}"
                  >
                    <i class="fas fa-user-check"></i>
                  </button>
                  } @if (client.status === 'Pending') {
                  <button
                    (click)="activateClient(client.id)"
                    class="p-2 text-green-600 hover:text-green-800 hover:bg-green-50 rounded-full transition-colors duration-200"
                    title="{{ 'approveClient' | i18n }}"
                  >
                    <i class="fas fa-check"></i>
                  </button>
                  <button
                    (click)="deactivateClient(client.id)"
                    class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-full transition-colors duration-200"
                    title="{{ 'rejectClient' | i18n }}"
                  >
                    <i class="fas fa-times"></i>
                  </button>
                  }
                </div>
              </td>
            </tr>
            } }
          </tbody>
        </table>
      </div>
      } @else {
      <div class="text-center py-12">
        <i class="fas fa-user-friends text-4xl text-gray-400 mb-4"></i>
        <h4 class="text-lg font-medium text-gray-900 mb-2">
          {{ "noClientsFound" | i18n }}
        </h4>
        <p class="text-gray-500">
          {{ "noClientsDescription" | i18n }}
        </p>
      </div>
      }
    </div>
    } }
  </div>
</div>

<!-- Modals -->
<!-- Quote Modal -->
@if (quoteRequest(); as req) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
>
  <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
    <h3 class="text-lg font-bold mb-4">
      {{ "quoteFor" | i18n }} "{{ req.title }}"
    </h3>
    <p class="text-sm text-gray-600 mb-4">{{ req.description }}</p>
    <label for="quoteAmount" class="block text-sm font-medium text-gray-700">{{
      "quoteValue" | i18n
    }}</label>
    <input
      type="number"
      id="quoteAmount"
      [(ngModel)]="quoteAmount"
      class="mt-1 w-full p-2 border rounded-md"
    />
    <div class="mt-6 flex justify-end space-x-3">
      <button
        (click)="quoteRequest.set(null)"
        class="px-4 py-2 rounded-md bg-gray-200"
      >
        {{ "cancel" | i18n }}
      </button>
      <button
        (click)="submitQuote()"
        [disabled]="!quoteAmount() || quoteAmount()! <= 0"
        class="px-4 py-2 rounded-md bg-indigo-600 text-white disabled:bg-indigo-300"
      >
        {{ "submit" | i18n }}
      </button>
      @if(req.status === 'Quoted') {
      <button
        (click)="respondToQuote(req.id, false)"
        class="px-4 py-2 rounded-md bg-red-600 text-white"
      >
        {{ "reject" | i18n }}
      </button>
      <button
        (click)="respondToQuote(req.id, true)"
        class="px-4 py-2 rounded-md bg-green-600 text-white"
      >
        {{ "approve" | i18n }}
      </button>
      }
    </div>
  </div>
</div>
}

<!-- Assign Professional Modal -->
@if (assignmentRequest(); as req) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
>
  <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md">
    <h3 class="text-lg font-bold mb-4">{{ "assignProfessional" | i18n }}</h3>
    <p class="text-sm text-gray-600 mb-4">
      {{ "selectProfessionalFor" | i18n }} "{{ req.title }}".
    </p>
    <label
      for="professionalSelect"
      class="block text-sm font-medium text-gray-700"
      >{{ "professional" | i18n }}</label
    >
    <select
      id="professionalSelect"
      [(ngModel)]="assigningProfessionalId"
      class="mt-1 w-full p-2 border rounded-md"
    >
      <option [ngValue]="null" disabled>
        {{ "selectAProfessional" | i18n }}
      </option>
      @for(pro of getProfessionalsForRequest(req.category); track pro.id) {
      <option [ngValue]="pro.id">{{ pro.name }}</option>
      }
    </select>
    <div class="mt-6 flex justify-end space-x-3">
      <button
        (click)="assignmentRequest.set(null)"
        class="px-4 py-2 rounded-md bg-gray-200"
      >
        {{ "cancel" | i18n }}
      </button>
      <button
        (click)="assignProfessional()"
        [disabled]="!assigningProfessionalId()"
        class="px-4 py-2 rounded-md bg-indigo-600 text-white disabled:bg-indigo-300"
      >
        {{ "assign" | i18n }}
      </button>
    </div>
  </div>
</div>
}

<!-- Edit Professional Modal -->
@if (editingProfessional(); as pro) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
>
  <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg">
    <h3 class="text-lg font-bold mb-4">{{ "editProfessional" | i18n }}</h3>
    <div class="space-y-4">
      <input
        type="text"
        [(ngModel)]="editingProfessionalName"
        [placeholder]="'name' | i18n"
        class="w-full p-2 border rounded-md"
      />
      <input
        type="email"
        [(ngModel)]="editingProfessionalEmail"
        [placeholder]="'email' | i18n"
        class="w-full p-2 border rounded-md"
      />
      <fieldset>
        <legend class="text-sm font-medium">{{ "specialties" | i18n }}</legend>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 mt-2">
          @for(cat of allCategories(); track cat) {
          <div>
            <input
              type="checkbox"
              [id]="'edit-pro-' + cat"
              [checked]="editingProfessionalSpecialties().includes(cat)"
              (change)="toggleEditProfessionalSpecialty(cat, $event)"
            /><label [for]="'edit-pro-' + cat" class="ml-2">{{ cat }}</label>
          </div>
          }
        </div>
      </fieldset>
    </div>
    <div class="mt-6 flex justify-end space-x-3">
      <button
        (click)="cancelEditProfessional()"
        class="px-4 py-2 rounded-md bg-gray-200"
      >
        {{ "cancel" | i18n }}
      </button>
      <button
        (click)="saveProfessionalEdit()"
        class="px-4 py-2 rounded-md bg-indigo-600 text-white"
      >
        {{ "saveChanges" | i18n }}
      </button>
    </div>
  </div>
</div>
}

<!-- Invoice Modal -->
@if (invoiceRequest(); as req) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print"
>
  <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl">
    <div class="invoice-content">
      <div class="flex justify-between items-center border-b pb-4 mb-6">
        <h2 class="text-3xl font-bold">{{ "invoice" | i18n }}</h2>
        <div class="text-right">
          <p class="font-semibold">{{ "appNameFull" | i18n }}</p>
          <p class="text-sm text-gray-500">123 Service Lane, Anytown</p>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-8 mb-8">
        <div>
          <h4 class="font-semibold text-gray-600 mb-1">
            {{ "billedTo" | i18n }}
          </h4>
          <p>{{ getClientName(req.client_id) }}</p>
          <p class="text-sm text-gray-500">{{ req.street }}, {{ req.city }}</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-600 mb-1">
            {{ "serviceProvidedBy" | i18n }}
          </h4>
          <p>{{ getProfessionalName(req.professional_id) }}</p>
        </div>
      </div>
      <h3 class="font-semibold text-gray-600 mb-2">
        {{ "serviceDescription" | i18n }}
      </h3>
      <table class="w-full mb-8">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left font-medium text-gray-600">
              {{ "description" | i18n }}
            </th>
            <th class="p-2 text-right font-medium text-gray-600">
              {{ "total" | i18n }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b">
            <td class="p-2">{{ req.title }}</td>
            <td class="p-2 text-right">{{ formatCost(req.cost) }}</td>
          </tr>
        </tbody>
      </table>
      <div class="flex justify-end">
        <div class="w-full max-w-xs">
          <div class="flex justify-between text-gray-600">
            <p>{{ "subtotal" | i18n }}</p>
            <p>{{ formatCost(req.cost) }}</p>
          </div>
          <div class="flex justify-between text-gray-600">
            <p>{{ "tax" | i18n }} (7%)</p>
            <p>{{ formatCost((req.cost ?? 0) * 0.07) }}</p>
          </div>
          <div
            class="flex justify-between font-bold text-xl mt-2 pt-2 border-t"
          >
            <p>{{ "grandTotal" | i18n }}</p>
            <p>{{ formatCost((req.cost ?? 0) * 1.07) }}</p>
          </div>
        </div>
      </div>
      <p class="text-center text-sm text-gray-500 mt-12">
        {{ "thankYou" | i18n }}
      </p>
    </div>
    <div class="mt-8 flex justify-end space-x-3 no-print">
      <button
        (click)="invoiceRequest.set(null)"
        class="px-4 py-2 rounded-md bg-gray-200"
      >
        {{ "close" | i18n }}
      </button>
      <button
        (click)="printInvoice()"
        class="px-4 py-2 rounded-md bg-indigo-600 text-white"
      >
        {{ "print" | i18n }}
      </button>
    </div>
  </div>
</div>
}
