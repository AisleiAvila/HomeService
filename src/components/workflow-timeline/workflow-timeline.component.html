<div class="workflow-timeline bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
  <!-- Cabeçalho com progresso geral -->
  <div class="mb-6">
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
        {{ "workflow_progress" | i18n }}
      </h3>
      <span class="text-sm text-gray-500 dark:text-gray-400">
        {{ "phase" | i18n }} {{ currentPhaseNumber() }} {{ "of" | i18n }} 4
      </span>
    </div>

    <!-- Barra de progresso -->
    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
      <div
        class="bg-brand-primary-500 h-2 rounded-full transition-all duration-500"
        [style.width]="progressPercentage() + '%'"
      ></div>
    </div>
    <div class="text-right mt-1">
      <span class="text-xs text-gray-500 dark:text-gray-400"
        >{{ progressPercentage() | number : "1.0-0" }}%</span
      >
    </div>

    <!-- Linha horizontal de status executados -->
    <div class="mt-4">
      <div class="flex items-center gap-2 overflow-x-auto pb-2">
        @for (status of executedStatuses(); track status.timestamp + (status.userName || ''); let isLast = $last; let idx = $index) {
          <!-- Status Badge -->
          <div 
            class="shrink-0 flex flex-col items-center"
          >
            <div
              class="flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all whitespace-nowrap"
              [ngClass]="{
                'bg-brand-primary-500 text-white ring-2 ring-brand-primary-300': status.isCurrent,
                'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200': !status.isCurrent
              }"
            >
              @if (status.isCurrent) {
                <i class="fas fa-circle-dot mr-1.5 animate-pulse"></i>
              } @else {
                <i class="fas fa-check-circle mr-1.5"></i>
              }
              <span>{{ status.name }}</span>
            </div>
            <div class="flex flex-col items-center mt-1 space-y-0.5">
              <span class="text-xs text-gray-500 dark:text-gray-400">{{ status.timestamp | date : 'dd/MM HH:mm' }}</span>
              @if (status.userName) {
                <span class="text-xs text-gray-600 dark:text-gray-300 font-medium">{{ status.userName }}</span>
              }
            </div>
          </div>
          
          <!-- Seta conectora (exceto no último) -->
          @if (!isLast) {
            <i class="fas fa-arrow-right text-gray-400 dark:text-gray-500 shrink-0"></i>
          }
        }
      </div>
    </div>
  </div>

  <!-- Informações de timing -->
  @if (serviceRequest().requested_datetime ||
  serviceRequest().scheduled_start_datetime) {
  <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
      {{ "timing_information" | i18n }}
    </h4>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      @if (serviceRequest().requested_datetime) {
      <div>
        <span class="text-gray-500 dark:text-gray-400">{{ "requested_at" | i18n }}:</span>
        <span class="ml-2 font-medium text-gray-900 dark:text-gray-100">
          {{ serviceRequest().requested_datetime | tzDate : serviceTz() : "dd/MM/yyyy HH:mm" }}
        </span>

        @if (serviceTz() === 'Atlantic/Azores') {
          <div class="ml-2 text-xs text-gray-500 dark:text-gray-400">
            {{ serviceRequest().requested_datetime | tzDate : 'Europe/Lisbon' : "dd/MM/yyyy HH:mm" }}
            <span class="ml-1">(Lisboa)</span>
          </div>
        }
      </div>
      } @if (serviceRequest().scheduled_start_datetime) {
      <div>
        <span class="text-gray-500 dark:text-gray-400">{{ "scheduled_for" | i18n }}:</span>
        <span class="ml-2 font-medium text-gray-900 dark:text-gray-100">
          {{
            serviceRequest().scheduled_start_datetime
              | tzDate : serviceTz() : "dd/MM/yyyy HH:mm"
          }}
        </span>

        @if (serviceTz() === 'Atlantic/Azores') {
          <div class="ml-2 text-xs text-gray-500 dark:text-gray-400">
            {{
              serviceRequest().scheduled_start_datetime
                | tzDate : 'Europe/Lisbon' : "dd/MM/yyyy HH:mm"
            }}
            <span class="ml-1">(Lisboa)</span>
          </div>
        }
      </div>
      } @if (serviceRequest().actual_start_datetime) {
      <div>
        <span class="text-gray-500 dark:text-gray-400">{{ "started_at" | i18n }}:</span>
        <span class="ml-2 font-medium text-gray-900 dark:text-gray-100">
          {{ serviceRequest().actual_start_datetime | tzDate : serviceTz() : "dd/MM/yyyy HH:mm" }}
        </span>

        @if (serviceTz() === 'Atlantic/Azores') {
          <div class="ml-2 text-xs text-gray-500 dark:text-gray-400">
            {{ serviceRequest().actual_start_datetime | tzDate : 'Europe/Lisbon' : "dd/MM/yyyy HH:mm" }}
            <span class="ml-1">(Lisboa)</span>
          </div>
        }
      </div>
      } @if (serviceRequest().actual_end_datetime) {
      <div>
        <span class="text-gray-500 dark:text-gray-400">{{ "completed_at" | i18n }}:</span>
        <span class="ml-2 font-medium text-gray-900 dark:text-gray-100">
          {{ serviceRequest().actual_end_datetime | tzDate : serviceTz() : "dd/MM/yyyy HH:mm" }}
        </span>

        @if (serviceTz() === 'Atlantic/Azores') {
          <div class="ml-2 text-xs text-gray-500 dark:text-gray-400">
            {{ serviceRequest().actual_end_datetime | tzDate : 'Europe/Lisbon' : "dd/MM/yyyy HH:mm" }}
            <span class="ml-1">(Lisboa)</span>
          </div>
        }
      </div>
      }
    </div>
  </div>
  }
</div>

