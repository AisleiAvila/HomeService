<div class="workflow-timeline bg-white rounded-lg shadow-sm border p-6">
  <!-- Cabeçalho com progresso geral -->
  <div class="mb-6">
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-lg font-semibold text-gray-900">
        {{ "workflow_progress" | i18n }}
      </h3>
      <span class="text-sm text-gray-500">
        {{ "phase" | i18n }} {{ currentPhaseNumber() }} {{ "of" | i18n }} 4
      </span>
    </div>

    <!-- Barra de progresso -->
    <div class="w-full bg-gray-200 rounded-full h-2">
      <div
        class="bg-brand-primary-500 h-2 rounded-full transition-all duration-500"
        [style.width]="progressPercentage() + '%'"
      ></div>
    </div>
    <div class="text-right mt-1">
      <span class="text-xs text-gray-500"
        >{{ progressPercentage() | number : "1.0-0" }}%</span
      >
    </div>

    <!-- Linha horizontal de status executados -->
    <div class="mt-4">
      <div class="flex items-center gap-2 overflow-x-auto pb-2">
        @for (status of executedStatuses(); track status.timestamp + (status.userName || ''); let isLast = $last; let idx = $index) {
          <!-- Status Badge -->
          <div 
            class="flex-shrink-0 flex flex-col items-center"
          >
            <div
              class="flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all whitespace-nowrap"
              [ngClass]="{
                'bg-brand-primary-500 text-white ring-2 ring-brand-primary-300': status.isCurrent,
                'bg-green-100 text-green-800': !status.isCurrent
              }"
            >
              @if (status.isCurrent) {
                <i class="fas fa-circle-dot mr-1.5 animate-pulse"></i>
              } @else {
                <i class="fas fa-check-circle mr-1.5"></i>
              }
              <span>{{ status.name }}</span>
            </div>
            <div class="flex flex-col items-center mt-1 space-y-0.5">
              <span class="text-xs text-gray-500">{{ status.timestamp | date : 'dd/MM HH:mm' }}</span>
              @if (status.userName) {
                <span class="text-xs text-gray-600 font-medium">{{ status.userName }}</span>
              }
            </div>
          </div>
          
          <!-- Seta conectora (exceto no último) -->
          @if (!isLast) {
            <i class="fas fa-arrow-right text-gray-400 flex-shrink-0"></i>
          }
        }
      </div>
    </div>
  </div>

  <!-- Informações de timing -->
  @if (serviceRequest().requested_datetime ||
  serviceRequest().scheduled_start_datetime) {
  <div class="mt-6 pt-6 border-t border-gray-200">
    <h4 class="text-sm font-medium text-gray-700 mb-3">
      {{ "timing_information" | i18n }}
    </h4>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      @if (serviceRequest().requested_datetime) {
      <div>
        <span class="text-gray-500">{{ "requested_at" | i18n }}:</span>
        <span class="ml-2 font-medium">
          {{ serviceRequest().requested_datetime | date : "dd/MM/yyyy HH:mm" }}
        </span>
      </div>
      } @if (serviceRequest().scheduled_start_datetime) {
      <div>
        <span class="text-gray-500">{{ "scheduled_for" | i18n }}:</span>
        <span class="ml-2 font-medium">
          {{
            serviceRequest().scheduled_start_datetime
              | date : "dd/MM/yyyy HH:mm"
          }}
        </span>
      </div>
      } @if (serviceRequest().actual_start_datetime) {
      <div>
        <span class="text-gray-500">{{ "started_at" | i18n }}:</span>
        <span class="ml-2 font-medium">
          {{
            serviceRequest().actual_start_datetime | date : "dd/MM/yyyy HH:mm"
          }}
        </span>
      </div>
      } @if (serviceRequest().actual_end_datetime) {
      <div>
        <span class="text-gray-500">{{ "completed_at" | i18n }}:</span>
        <span class="ml-2 font-medium">
          {{ serviceRequest().actual_end_datetime | date : "dd/MM/yyyy HH:mm" }}
        </span>
      </div>
      }
    </div>
  </div>
  }
</div>

